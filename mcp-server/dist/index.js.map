{"version":3,"sources":["../src/utils/hash.ts","../src/storage/migrations/001_initial.ts","../src/storage/migrations/002_impact_tracking.ts","../src/storage/migrations/index.ts","../src/storage/sqlite.ts","../src/storage/jsonl.ts","../src/utils/paths.ts","../src/storage/index.ts","../src/vector/embeddings.ts","../src/vector/qdrant.ts","../src/utils/id-generator.ts","../src/vector/index.ts","../src/confirmation/aggregator.ts","../src/confirmation/promoter.ts","../src/confirmation/contradiction.ts","../src/confirmation/fuzzy-matcher.ts","../src/confirmation/index.ts","../src/sync/file-transport.ts","../src/sync/urgent.ts","../src/sync/index.ts","../src/schemas/config.ts","../src/types/index.ts","../src/schemas/observation.ts","../src/schemas/tools.ts","../src/tools/observe.ts","../src/tools/lookup.ts","../src/tools/search.ts","../src/tools/failures.ts","../src/tools/confirm.ts","../src/tools/stats.ts","../src/tools/semantic-search.ts","../src/tools/report-impact.ts","../src/resources/domains.ts","../src/resources/domain.ts","../src/resources/failures.ts","../src/resources/stats.ts","../src/server.ts","../src/transports/sse.ts","../src/index.ts"],"names":["down","up","version","dirname","existsSync","mkdirSync","join","readFileSync","z","result","output","results","hashAgentId"],"mappings":"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","file":"index.js","sourcesContent":["import { createHash } from 'node:crypto';\n\n/**\n * Generate SHA-256 hash of a string\n */\nexport function sha256(input: string): string {\n  return createHash('sha256').update(input).digest('hex');\n}\n\n/**\n * Generate a hash of the agent identifier for privacy\n */\nexport function hashAgentId(agentId: string): string {\n  return sha256(`substrate:agent:${agentId}`);\n}\n\n/**\n * Recursively sort object keys for consistent JSON serialization\n */\nfunction sortObjectKeys(obj: unknown): unknown {\n  if (obj === null || typeof obj !== 'object') {\n    return obj;\n  }\n  if (Array.isArray(obj)) {\n    return obj.map(sortObjectKeys);\n  }\n  const sorted: Record<string, unknown> = {};\n  for (const key of Object.keys(obj as Record<string, unknown>).sort()) {\n    sorted[key] = sortObjectKeys((obj as Record<string, unknown>)[key]);\n  }\n  return sorted;\n}\n\n/**\n * Generate a content hash for deduplication and grouping\n * Based on domain, path, category, and structured_data\n */\nexport function generateContentHash(\n  domain: string,\n  path: string | undefined,\n  category: string,\n  structuredData: unknown\n): string {\n  const canonical = {\n    category,\n    domain: domain.toLowerCase(),\n    path: path?.toLowerCase() ?? '',\n    structured_data: sortObjectKeys(structuredData) ?? null,\n  };\n\n  return sha256(JSON.stringify(canonical));\n}\n\n/**\n * Generate a summary hash for fuzzy matching (v0.3)\n * Normalizes the summary text for comparison\n */\nexport function generateSummaryHash(summary: string): string {\n  const normalized = summary\n    .toLowerCase()\n    .replace(/\\s+/g, ' ')\n    .trim();\n  return sha256(normalized);\n}\n","import type Database from 'better-sqlite3';\n\nexport const version = 1;\n\nexport function up(db: Database.Database): void {\n  // Main observations table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS observations (\n      id TEXT PRIMARY KEY,\n      agent_hash TEXT NOT NULL,\n      domain TEXT NOT NULL,\n      path TEXT,\n      category TEXT NOT NULL,\n      summary TEXT NOT NULL,\n      structured_data TEXT,\n      status TEXT NOT NULL DEFAULT 'pending',\n      confirmations INTEGER NOT NULL DEFAULT 1,\n      confirming_agents TEXT NOT NULL DEFAULT '[]',\n      confidence REAL NOT NULL DEFAULT 0,\n      urgency TEXT NOT NULL DEFAULT 'normal',\n      tags TEXT NOT NULL DEFAULT '[]',\n      content_hash TEXT NOT NULL,\n      vector_id TEXT,\n      created_at TEXT NOT NULL,\n      updated_at TEXT NOT NULL,\n      expires_at TEXT\n    );\n\n    -- Indices for common queries\n    CREATE INDEX IF NOT EXISTS idx_observations_domain ON observations(domain);\n    CREATE INDEX IF NOT EXISTS idx_observations_domain_path ON observations(domain, path);\n    CREATE INDEX IF NOT EXISTS idx_observations_category ON observations(category);\n    CREATE INDEX IF NOT EXISTS idx_observations_status ON observations(status);\n    CREATE INDEX IF NOT EXISTS idx_observations_content_hash ON observations(content_hash);\n    CREATE INDEX IF NOT EXISTS idx_observations_created_at ON observations(created_at);\n    CREATE INDEX IF NOT EXISTS idx_observations_urgency ON observations(urgency);\n\n    -- Composite index for confirmation grouping\n    CREATE INDEX IF NOT EXISTS idx_observations_aggregation\n      ON observations(domain, path, category, content_hash);\n  `);\n\n  // Confirmation tracking table (for efficient aggregation)\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS confirmation_groups (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      domain TEXT NOT NULL,\n      path TEXT,\n      category TEXT NOT NULL,\n      content_hash TEXT NOT NULL,\n      canonical_observation_id TEXT NOT NULL,\n      total_confirmations INTEGER NOT NULL DEFAULT 1,\n      unique_agents TEXT NOT NULL DEFAULT '[]',\n      status TEXT NOT NULL DEFAULT 'pending',\n      confidence REAL NOT NULL DEFAULT 0,\n      created_at TEXT NOT NULL,\n      updated_at TEXT NOT NULL,\n      UNIQUE(domain, path, category, content_hash)\n    );\n\n    CREATE INDEX IF NOT EXISTS idx_confirmation_groups_lookup\n      ON confirmation_groups(domain, path, category, content_hash);\n  `);\n\n  // Sync state tracking\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS sync_state (\n      peer_name TEXT PRIMARY KEY,\n      last_sync_at TEXT,\n      last_observation_id TEXT,\n      sync_count INTEGER NOT NULL DEFAULT 0\n    );\n  `);\n\n  // Metadata table for schema versioning\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS metadata (\n      key TEXT PRIMARY KEY,\n      value TEXT NOT NULL\n    );\n\n    INSERT OR REPLACE INTO metadata (key, value) VALUES ('schema_version', '1');\n  `);\n}\n\nexport function down(db: Database.Database): void {\n  db.exec(`\n    DROP TABLE IF EXISTS observations;\n    DROP TABLE IF EXISTS confirmation_groups;\n    DROP TABLE IF EXISTS sync_state;\n    DROP TABLE IF EXISTS metadata;\n  `);\n}\n","import type Database from 'better-sqlite3';\n\nexport const version = 2;\n\nexport function up(db: Database.Database): void {\n  // Add impact tracking columns to observations table\n  db.exec(`\n    ALTER TABLE observations ADD COLUMN impact_estimate TEXT;\n    ALTER TABLE observations ADD COLUMN impact_reports TEXT NOT NULL DEFAULT '[]';\n    ALTER TABLE observations ADD COLUMN impact_stats TEXT;\n  `);\n\n  // Create index for finding high-impact observations\n  db.exec(`\n    CREATE INDEX IF NOT EXISTS idx_observations_impact\n      ON observations(json_extract(impact_stats, '$.total_uses'));\n  `);\n\n  // Update schema version\n  db.exec(`\n    UPDATE metadata SET value = '2' WHERE key = 'schema_version';\n  `);\n}\n\nexport function down(db: Database.Database): void {\n  // SQLite doesn't support DROP COLUMN easily, so we'd need to recreate the table\n  // For simplicity, we'll just leave the columns in place on downgrade\n  db.exec(`\n    UPDATE metadata SET value = '1' WHERE key = 'schema_version';\n  `);\n}\n","import type Database from 'better-sqlite3';\nimport * as migration001 from './001_initial.js';\nimport * as migration002 from './002_impact_tracking.js';\n\ninterface Migration {\n  version: number;\n  up: (db: Database.Database) => void;\n  down: (db: Database.Database) => void;\n}\n\nconst migrations: Migration[] = [\n  migration001,\n  migration002,\n];\n\nexport function getCurrentVersion(db: Database.Database): number {\n  try {\n    const row = db.prepare('SELECT value FROM metadata WHERE key = ?').get('schema_version') as { value: string } | undefined;\n    return row ? parseInt(row.value, 10) : 0;\n  } catch {\n    return 0;\n  }\n}\n\nexport function runMigrations(db: Database.Database): void {\n  const currentVersion = getCurrentVersion(db);\n\n  for (const migration of migrations) {\n    if (migration.version > currentVersion) {\n      db.transaction(() => {\n        migration.up(db);\n        db.prepare('INSERT OR REPLACE INTO metadata (key, value) VALUES (?, ?)').run('schema_version', migration.version.toString());\n      })();\n    }\n  }\n}\n\nexport { migrations };\n","import Database from 'better-sqlite3';\nimport { mkdirSync, existsSync } from 'fs';\nimport { dirname } from 'path';\nimport type { StoredObservation, ObservationStatus, ObservationCategory } from '../schemas/observation.js';\nimport { runMigrations } from './migrations/index.js';\n\nexport interface QueryOptions {\n  domain?: string;\n  path?: string;\n  category?: ObservationCategory;\n  status?: ObservationStatus;\n  since?: string;\n  limit?: number;\n  offset?: number;\n}\n\nexport interface ConfirmationGroup {\n  id: number;\n  domain: string;\n  path: string | null;\n  category: string;\n  content_hash: string;\n  canonical_observation_id: string;\n  total_confirmations: number;\n  unique_agents: string[];\n  status: ObservationStatus;\n  confidence: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface DomainStats {\n  domain: string;\n  count: number;\n}\n\nexport interface ObservationStats {\n  total_observations: number;\n  observations_by_status: Record<string, number>;\n  observations_by_category: Record<string, number>;\n  domains_count: number;\n  top_domains: DomainStats[];\n}\n\nexport class SQLiteStorage {\n  private db: Database.Database;\n\n  constructor(dbPath: string) {\n    // Ensure the directory exists before opening database\n    const dir = dirname(dbPath);\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n    this.db = new Database(dbPath);\n    this.db.pragma('journal_mode = WAL');\n    this.db.pragma('foreign_keys = ON');\n    runMigrations(this.db);\n  }\n\n  // ============================================================================\n  // Observation CRUD\n  // ============================================================================\n\n  insertObservation(observation: StoredObservation): void {\n    const stmt = this.db.prepare(`\n      INSERT INTO observations (\n        id, agent_hash, domain, path, category, summary, structured_data,\n        status, confirmations, confirming_agents, confidence, urgency, tags,\n        content_hash, vector_id, created_at, updated_at, expires_at,\n        impact_estimate, impact_reports, impact_stats\n      ) VALUES (\n        ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?\n      )\n    `);\n\n    stmt.run(\n      observation.id,\n      observation.agent_hash,\n      observation.domain,\n      observation.path ?? null,\n      observation.category,\n      observation.summary,\n      observation.structured_data ? JSON.stringify(observation.structured_data) : null,\n      observation.status,\n      observation.confirmations,\n      JSON.stringify(observation.confirming_agents),\n      observation.confidence,\n      observation.urgency,\n      JSON.stringify(observation.tags),\n      observation.content_hash,\n      observation.vector_id ?? null,\n      observation.created_at,\n      observation.updated_at,\n      observation.expires_at ?? null,\n      observation.impact_estimate ? JSON.stringify(observation.impact_estimate) : null,\n      JSON.stringify(observation.impact_reports ?? []),\n      observation.impact_stats ? JSON.stringify(observation.impact_stats) : null\n    );\n  }\n\n  getObservation(id: string): StoredObservation | null {\n    const row = this.db.prepare('SELECT * FROM observations WHERE id = ?').get(id) as Record<string, unknown> | undefined;\n    return row ? this.rowToObservation(row) : null;\n  }\n\n  updateObservation(id: string, updates: Partial<StoredObservation>): void {\n    const current = this.getObservation(id);\n    if (!current) return;\n\n    const updated = { ...current, ...updates, updated_at: new Date().toISOString() };\n\n    const stmt = this.db.prepare(`\n      UPDATE observations SET\n        status = ?, confirmations = ?, confirming_agents = ?, confidence = ?,\n        updated_at = ?, vector_id = ?,\n        impact_estimate = ?, impact_reports = ?, impact_stats = ?\n      WHERE id = ?\n    `);\n\n    stmt.run(\n      updated.status,\n      updated.confirmations,\n      JSON.stringify(updated.confirming_agents),\n      updated.confidence,\n      updated.updated_at,\n      updated.vector_id ?? null,\n      updated.impact_estimate ? JSON.stringify(updated.impact_estimate) : null,\n      JSON.stringify(updated.impact_reports ?? []),\n      updated.impact_stats ? JSON.stringify(updated.impact_stats) : null,\n      id\n    );\n  }\n\n  /**\n   * Add an impact report to an observation and update aggregated stats\n   */\n  addImpactReport(id: string, report: {\n    agent_hash: string;\n    helpful: boolean;\n    task_succeeded?: boolean;\n    actual_time_saved_seconds?: number;\n    feedback?: string;\n  }): { success: boolean; updated_stats?: StoredObservation['impact_stats'] } {\n    const observation = this.getObservation(id);\n    if (!observation) {\n      return { success: false };\n    }\n\n    // Add the report\n    const reports = observation.impact_reports ?? [];\n    reports.push({\n      ...report,\n      reported_at: new Date().toISOString(),\n    });\n\n    // Calculate updated stats\n    const totalUses = reports.length;\n    const helpfulCount = reports.filter(r => r.helpful).length;\n    const successReports = reports.filter(r => r.task_succeeded !== undefined);\n    const successCount = successReports.filter(r => r.task_succeeded).length;\n    const timeReports = reports.filter(r => r.actual_time_saved_seconds !== undefined);\n    const avgTimeSaved = timeReports.length > 0\n      ? timeReports.reduce((sum, r) => sum + (r.actual_time_saved_seconds ?? 0), 0) / timeReports.length\n      : undefined;\n\n    const updatedStats = {\n      total_uses: totalUses,\n      helpful_count: helpfulCount,\n      avg_time_saved_seconds: avgTimeSaved,\n      success_rate: successReports.length > 0\n        ? (successCount / successReports.length) * 100\n        : undefined,\n    };\n\n    this.updateObservation(id, {\n      impact_reports: reports,\n      impact_stats: updatedStats,\n    });\n\n    return { success: true, updated_stats: updatedStats };\n  }\n\n  queryObservations(options: QueryOptions): StoredObservation[] {\n    let sql = 'SELECT * FROM observations WHERE 1=1';\n    const params: unknown[] = [];\n\n    if (options.domain) {\n      sql += ' AND domain = ?';\n      params.push(options.domain);\n    }\n\n    if (options.path) {\n      sql += ' AND path = ?';\n      params.push(options.path);\n    }\n\n    if (options.category) {\n      sql += ' AND category = ?';\n      params.push(options.category);\n    }\n\n    if (options.status) {\n      sql += ' AND status = ?';\n      params.push(options.status);\n    }\n\n    if (options.since) {\n      sql += ' AND created_at >= ?';\n      params.push(options.since);\n    }\n\n    sql += ' ORDER BY created_at DESC';\n\n    if (options.limit) {\n      sql += ' LIMIT ?';\n      params.push(options.limit);\n    }\n\n    if (options.offset) {\n      sql += ' OFFSET ?';\n      params.push(options.offset);\n    }\n\n    const rows = this.db.prepare(sql).all(...params) as Record<string, unknown>[];\n    return rows.map(row => this.rowToObservation(row));\n  }\n\n  countObservations(options: QueryOptions): number {\n    let sql = 'SELECT COUNT(*) as count FROM observations WHERE 1=1';\n    const params: unknown[] = [];\n\n    if (options.domain) {\n      sql += ' AND domain = ?';\n      params.push(options.domain);\n    }\n\n    if (options.path) {\n      sql += ' AND path = ?';\n      params.push(options.path);\n    }\n\n    if (options.category) {\n      sql += ' AND category = ?';\n      params.push(options.category);\n    }\n\n    if (options.status) {\n      sql += ' AND status = ?';\n      params.push(options.status);\n    }\n\n    const row = this.db.prepare(sql).get(...params) as { count: number };\n    return row.count;\n  }\n\n  // ============================================================================\n  // Confirmation Groups\n  // ============================================================================\n\n  findConfirmationGroup(\n    domain: string,\n    path: string | undefined,\n    category: string,\n    contentHash: string\n  ): ConfirmationGroup | null {\n    const row = this.db.prepare(`\n      SELECT * FROM confirmation_groups\n      WHERE domain = ? AND path IS ? AND category = ? AND content_hash = ?\n    `).get(domain, path ?? null, category, contentHash) as Record<string, unknown> | undefined;\n\n    return row ? this.rowToConfirmationGroup(row) : null;\n  }\n\n  createConfirmationGroup(\n    domain: string,\n    path: string | undefined,\n    category: string,\n    contentHash: string,\n    observationId: string,\n    agentHash: string\n  ): ConfirmationGroup {\n    const now = new Date().toISOString();\n\n    this.db.prepare(`\n      INSERT INTO confirmation_groups (\n        domain, path, category, content_hash, canonical_observation_id,\n        total_confirmations, unique_agents, status, confidence, created_at, updated_at\n      ) VALUES (?, ?, ?, ?, ?, 1, ?, 'pending', 0, ?, ?)\n    `).run(domain, path ?? null, category, contentHash, observationId, JSON.stringify([agentHash]), now, now);\n\n    return this.findConfirmationGroup(domain, path, category, contentHash)!;\n  }\n\n  updateConfirmationGroup(\n    id: number,\n    updates: Partial<Pick<ConfirmationGroup, 'total_confirmations' | 'unique_agents' | 'status' | 'confidence'>>\n  ): void {\n    const now = new Date().toISOString();\n\n    if (updates.total_confirmations !== undefined || updates.unique_agents !== undefined) {\n      this.db.prepare(`\n        UPDATE confirmation_groups\n        SET total_confirmations = COALESCE(?, total_confirmations),\n            unique_agents = COALESCE(?, unique_agents),\n            status = COALESCE(?, status),\n            confidence = COALESCE(?, confidence),\n            updated_at = ?\n        WHERE id = ?\n      `).run(\n        updates.total_confirmations ?? null,\n        updates.unique_agents ? JSON.stringify(updates.unique_agents) : null,\n        updates.status ?? null,\n        updates.confidence ?? null,\n        now,\n        id\n      );\n    }\n  }\n\n  // ============================================================================\n  // Statistics\n  // ============================================================================\n\n  getStats(domain?: string): ObservationStats {\n    const whereClause = domain ? 'WHERE domain = ?' : '';\n    const params = domain ? [domain] : [];\n\n    const totalRow = this.db.prepare(`SELECT COUNT(*) as count FROM observations ${whereClause}`).get(...params) as { count: number };\n\n    const statusRows = this.db.prepare(`\n      SELECT status, COUNT(*) as count FROM observations ${whereClause} GROUP BY status\n    `).all(...params) as { status: string; count: number }[];\n\n    const categoryRows = this.db.prepare(`\n      SELECT category, COUNT(*) as count FROM observations ${whereClause} GROUP BY category\n    `).all(...params) as { category: string; count: number }[];\n\n    const domainsRow = this.db.prepare('SELECT COUNT(DISTINCT domain) as count FROM observations').get() as { count: number };\n\n    const topDomainsRows = this.db.prepare(`\n      SELECT domain, COUNT(*) as count FROM observations\n      GROUP BY domain ORDER BY count DESC LIMIT 10\n    `).all() as DomainStats[];\n\n    return {\n      total_observations: totalRow.count,\n      observations_by_status: Object.fromEntries(statusRows.map(r => [r.status, r.count])),\n      observations_by_category: Object.fromEntries(categoryRows.map(r => [r.category, r.count])),\n      domains_count: domainsRow.count,\n      top_domains: topDomainsRows,\n    };\n  }\n\n  getAllDomains(): DomainStats[] {\n    const rows = this.db.prepare(`\n      SELECT domain, COUNT(*) as count FROM observations\n      GROUP BY domain ORDER BY count DESC\n    `).all() as DomainStats[];\n    return rows;\n  }\n\n  // ============================================================================\n  // Failures\n  // ============================================================================\n\n  getFailures(options: { domain?: string; since?: string; limit?: number }): StoredObservation[] {\n    let sql = `\n      SELECT * FROM observations\n      WHERE category = 'error' AND (urgency = 'high' OR urgency = 'critical')\n    `;\n    const params: unknown[] = [];\n\n    if (options.domain) {\n      sql += ' AND domain = ?';\n      params.push(options.domain);\n    }\n\n    if (options.since) {\n      sql += ' AND created_at >= ?';\n      params.push(options.since);\n    }\n\n    sql += ' ORDER BY created_at DESC';\n\n    if (options.limit) {\n      sql += ' LIMIT ?';\n      params.push(options.limit);\n    }\n\n    const rows = this.db.prepare(sql).all(...params) as Record<string, unknown>[];\n    return rows.map(row => this.rowToObservation(row));\n  }\n\n  // ============================================================================\n  // Sync State\n  // ============================================================================\n\n  getSyncState(peerName: string): { last_sync_at: string | null; last_observation_id: string | null; sync_count: number } | null {\n    const row = this.db.prepare('SELECT * FROM sync_state WHERE peer_name = ?').get(peerName) as Record<string, unknown> | undefined;\n    if (!row) return null;\n    return {\n      last_sync_at: row['last_sync_at'] as string | null,\n      last_observation_id: row['last_observation_id'] as string | null,\n      sync_count: row['sync_count'] as number,\n    };\n  }\n\n  updateSyncState(peerName: string, lastSyncAt: string, lastObservationId: string): void {\n    this.db.prepare(`\n      INSERT INTO sync_state (peer_name, last_sync_at, last_observation_id, sync_count)\n      VALUES (?, ?, ?, 1)\n      ON CONFLICT(peer_name) DO UPDATE SET\n        last_sync_at = excluded.last_sync_at,\n        last_observation_id = excluded.last_observation_id,\n        sync_count = sync_count + 1\n    `).run(peerName, lastSyncAt, lastObservationId);\n  }\n\n  // ============================================================================\n  // Helpers\n  // ============================================================================\n\n  private rowToObservation(row: Record<string, unknown>): StoredObservation {\n    return {\n      id: row['id'] as string,\n      agent_hash: row['agent_hash'] as string,\n      domain: row['domain'] as string,\n      path: row['path'] as string | undefined,\n      category: row['category'] as ObservationCategory,\n      summary: row['summary'] as string,\n      structured_data: row['structured_data'] ? JSON.parse(row['structured_data'] as string) : undefined,\n      impact_estimate: row['impact_estimate'] ? JSON.parse(row['impact_estimate'] as string) : undefined,\n      impact_reports: row['impact_reports'] ? JSON.parse(row['impact_reports'] as string) : [],\n      impact_stats: row['impact_stats'] ? JSON.parse(row['impact_stats'] as string) : undefined,\n      status: row['status'] as ObservationStatus,\n      confirmations: row['confirmations'] as number,\n      confirming_agents: JSON.parse(row['confirming_agents'] as string),\n      confidence: row['confidence'] as number,\n      urgency: row['urgency'] as 'normal' | 'high' | 'critical',\n      tags: JSON.parse(row['tags'] as string),\n      content_hash: row['content_hash'] as string,\n      vector_id: row['vector_id'] as string | undefined,\n      created_at: row['created_at'] as string,\n      updated_at: row['updated_at'] as string,\n      expires_at: row['expires_at'] as string | undefined,\n    };\n  }\n\n  private rowToConfirmationGroup(row: Record<string, unknown>): ConfirmationGroup {\n    return {\n      id: row['id'] as number,\n      domain: row['domain'] as string,\n      path: row['path'] as string | null,\n      category: row['category'] as string,\n      content_hash: row['content_hash'] as string,\n      canonical_observation_id: row['canonical_observation_id'] as string,\n      total_confirmations: row['total_confirmations'] as number,\n      unique_agents: JSON.parse(row['unique_agents'] as string),\n      status: row['status'] as ObservationStatus,\n      confidence: row['confidence'] as number,\n      created_at: row['created_at'] as string,\n      updated_at: row['updated_at'] as string,\n    };\n  }\n\n  close(): void {\n    this.db.close();\n  }\n}\n","import { appendFileSync, readFileSync, existsSync, mkdirSync } from 'node:fs';\nimport { dirname } from 'node:path';\nimport type { StoredObservation } from '../schemas/observation.js';\n\n/**\n * Append-only JSONL log for observations\n * Provides durability and easy export/sync\n */\nexport class JSONLStorage {\n  private filePath: string;\n\n  constructor(filePath: string) {\n    this.filePath = filePath;\n    // Ensure the directory exists\n    const dir = dirname(filePath);\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n  }\n\n  /**\n   * Append an observation to the log\n   */\n  append(observation: StoredObservation): void {\n    const line = JSON.stringify(observation) + '\\n';\n    appendFileSync(this.filePath, line, 'utf8');\n  }\n\n  /**\n   * Append multiple observations in a batch\n   */\n  appendBatch(observations: StoredObservation[]): void {\n    const lines = observations.map(o => JSON.stringify(o)).join('\\n') + '\\n';\n    appendFileSync(this.filePath, lines, 'utf8');\n  }\n\n  /**\n   * Read all observations from the log\n   */\n  readAll(): StoredObservation[] {\n    if (!existsSync(this.filePath)) {\n      return [];\n    }\n\n    const content = readFileSync(this.filePath, 'utf8');\n    const lines = content.trim().split('\\n').filter(line => line.length > 0);\n\n    return lines.map(line => JSON.parse(line) as StoredObservation);\n  }\n\n  /**\n   * Read observations since a specific ID\n   * Used for incremental sync\n   */\n  readSince(sinceId: string | null): StoredObservation[] {\n    const all = this.readAll();\n\n    if (!sinceId) {\n      return all;\n    }\n\n    const sinceIndex = all.findIndex(o => o.id === sinceId);\n    if (sinceIndex === -1) {\n      return all;\n    }\n\n    return all.slice(sinceIndex + 1);\n  }\n\n  /**\n   * Get the last observation in the log\n   */\n  getLastObservation(): StoredObservation | null {\n    const all = this.readAll();\n    return all.length > 0 ? all[all.length - 1]! : null;\n  }\n\n  /**\n   * Count observations in the log\n   */\n  count(): number {\n    if (!existsSync(this.filePath)) {\n      return 0;\n    }\n\n    const content = readFileSync(this.filePath, 'utf8');\n    return content.trim().split('\\n').filter(line => line.length > 0).length;\n  }\n\n  /**\n   * Get the file path\n   */\n  getPath(): string {\n    return this.filePath;\n  }\n}\n","import { homedir } from 'node:os';\nimport { join } from 'node:path';\nimport { mkdirSync, existsSync } from 'node:fs';\n\n/**\n * Get the default data directory for Substrate\n */\nexport function getDefaultDataDir(): string {\n  const baseDir = process.env['SUBSTRATE_DATA_DIR'] ??\n    process.env['XDG_DATA_HOME'] ??\n    join(homedir(), '.local', 'share');\n\n  return join(baseDir, 'substrate');\n}\n\n/**\n * Ensure a directory exists, creating it if necessary\n */\nexport function ensureDir(dirPath: string): void {\n  if (!existsSync(dirPath)) {\n    mkdirSync(dirPath, { recursive: true });\n  }\n}\n\n/**\n * Get all paths for the Substrate data directory\n */\nexport function getDataPaths(dataDir: string) {\n  return {\n    root: dataDir,\n    sqlite: join(dataDir, 'substrate.db'),\n    jsonl: join(dataDir, 'observations.jsonl'),\n    outbox: join(dataDir, 'outbox'),\n    config: join(dataDir, 'config.json'),\n    logs: join(dataDir, 'logs'),\n  };\n}\n\n/**\n * Initialize the data directory structure\n */\nexport function initializeDataDir(dataDir: string): ReturnType<typeof getDataPaths> {\n  const paths = getDataPaths(dataDir);\n\n  ensureDir(paths.root);\n  ensureDir(paths.outbox);\n  ensureDir(paths.logs);\n\n  return paths;\n}\n","import { SQLiteStorage } from './sqlite.js';\nimport { JSONLStorage } from './jsonl.js';\nimport type { StoredObservation, ObservationCategory, ObservationStatus } from '../schemas/observation.js';\nimport type { SubstrateConfig } from '../schemas/config.js';\nimport { initializeDataDir } from '../utils/paths.js';\n\nexport interface StorageQueryOptions {\n  domain?: string;\n  path?: string;\n  category?: ObservationCategory;\n  status?: ObservationStatus;\n  since?: string;\n  limit?: number;\n  offset?: number;\n}\n\n/**\n * Storage facade that coordinates SQLite (for queries) and JSONL (for durability)\n */\nexport class Storage {\n  private sqlite: SQLiteStorage;\n  private jsonl: JSONLStorage;\n\n  constructor(config: SubstrateConfig) {\n    const paths = initializeDataDir(config.data_dir);\n    const sqlitePath = config.sqlite_path ?? paths.sqlite;\n    const jsonlPath = config.jsonl_path ?? paths.jsonl;\n\n    this.sqlite = new SQLiteStorage(sqlitePath);\n    this.jsonl = new JSONLStorage(jsonlPath);\n  }\n\n  /**\n   * Insert an observation into both storage backends\n   */\n  insert(observation: StoredObservation): void {\n    // Write to both storage backends\n    this.sqlite.insertObservation(observation);\n    this.jsonl.append(observation);\n  }\n\n  /**\n   * Get an observation by ID\n   */\n  get(id: string): StoredObservation | null {\n    return this.sqlite.getObservation(id);\n  }\n\n  /**\n   * Update an observation\n   */\n  update(id: string, updates: Partial<StoredObservation>): void {\n    this.sqlite.updateObservation(id, updates);\n    // Note: JSONL is append-only, updates are not reflected there\n    // The JSONL serves as a write-ahead log, SQLite is the source of truth for current state\n  }\n\n  /**\n   * Query observations with filters\n   */\n  query(options: StorageQueryOptions): StoredObservation[] {\n    return this.sqlite.queryObservations(options);\n  }\n\n  /**\n   * Count observations matching filters\n   */\n  count(options: StorageQueryOptions): number {\n    return this.sqlite.countObservations(options);\n  }\n\n  /**\n   * Get observation statistics\n   */\n  getStats(domain?: string) {\n    return this.sqlite.getStats(domain);\n  }\n\n  /**\n   * Get all domains with observation counts\n   */\n  getAllDomains() {\n    return this.sqlite.getAllDomains();\n  }\n\n  /**\n   * Get failure observations\n   */\n  getFailures(options: { domain?: string; since?: string; limit?: number }) {\n    return this.sqlite.getFailures(options);\n  }\n\n  /**\n   * Add an impact report to an observation\n   */\n  addImpactReport(id: string, report: {\n    agent_hash: string;\n    helpful: boolean;\n    task_succeeded?: boolean;\n    actual_time_saved_seconds?: number;\n    feedback?: string;\n  }) {\n    return this.sqlite.addImpactReport(id, report);\n  }\n\n  /**\n   * Find an existing confirmation group\n   */\n  findConfirmationGroup(domain: string, path: string | undefined, category: string, contentHash: string) {\n    return this.sqlite.findConfirmationGroup(domain, path, category, contentHash);\n  }\n\n  /**\n   * Create a new confirmation group\n   */\n  createConfirmationGroup(\n    domain: string,\n    path: string | undefined,\n    category: string,\n    contentHash: string,\n    observationId: string,\n    agentHash: string\n  ) {\n    return this.sqlite.createConfirmationGroup(domain, path, category, contentHash, observationId, agentHash);\n  }\n\n  /**\n   * Update a confirmation group\n   */\n  updateConfirmationGroup(\n    id: number,\n    updates: { total_confirmations?: number; unique_agents?: string[]; status?: ObservationStatus; confidence?: number }\n  ) {\n    return this.sqlite.updateConfirmationGroup(id, updates);\n  }\n\n  /**\n   * Get sync state for a peer\n   */\n  getSyncState(peerName: string) {\n    return this.sqlite.getSyncState(peerName);\n  }\n\n  /**\n   * Update sync state for a peer\n   */\n  updateSyncState(peerName: string, lastSyncAt: string, lastObservationId: string) {\n    return this.sqlite.updateSyncState(peerName, lastSyncAt, lastObservationId);\n  }\n\n  /**\n   * Read observations from JSONL since a specific ID (for sync)\n   */\n  readJSONLSince(sinceId: string | null): StoredObservation[] {\n    return this.jsonl.readSince(sinceId);\n  }\n\n  /**\n   * Close storage connections\n   */\n  close(): void {\n    this.sqlite.close();\n  }\n}\n\nexport { SQLiteStorage } from './sqlite.js';\nexport { JSONLStorage } from './jsonl.js';\n","import type { EmbeddingConfig } from '../schemas/config.js';\n\n// Use dynamic imports to handle the transformers library\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlet embeddingPipeline: any = null;\n\n/**\n * Embedding generator using Transformers.js\n */\nexport class EmbeddingGenerator {\n  private config: EmbeddingConfig;\n  private initialized: boolean = false;\n\n  constructor(config: EmbeddingConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the embedding pipeline\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) return;\n\n    const { pipeline } = await import('@xenova/transformers');\n    embeddingPipeline = await pipeline('feature-extraction', this.config.model, {\n      quantized: true,\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Generate embedding for a single text\n   */\n  async embed(text: string): Promise<number[]> {\n    await this.initialize();\n\n    if (!embeddingPipeline) {\n      throw new Error('Embedding pipeline not initialized');\n    }\n\n    const output = await embeddingPipeline(text, {\n      pooling: 'mean',\n      normalize: true,\n    });\n\n    // Extract the embedding array - output is a Tensor with data property\n    const tensor = output as { data: Float32Array };\n    return Array.from(tensor.data);\n  }\n\n  /**\n   * Generate embeddings for multiple texts in batch\n   */\n  async embedBatch(texts: string[]): Promise<number[][]> {\n    await this.initialize();\n\n    if (!embeddingPipeline) {\n      throw new Error('Embedding pipeline not initialized');\n    }\n\n    const results: number[][] = [];\n\n    // Process in batches\n    for (let i = 0; i < texts.length; i += this.config.batch_size) {\n      const batch = texts.slice(i, i + this.config.batch_size);\n      const batchResults = await Promise.all(batch.map(text => this.embed(text)));\n      results.push(...batchResults);\n    }\n\n    return results;\n  }\n\n  /**\n   * Get the dimension of the embeddings\n   */\n  getDimension(): number {\n    return this.config.dimension;\n  }\n\n  /**\n   * Create searchable text from observation fields\n   */\n  static createSearchableText(\n    domain: string,\n    path: string | undefined,\n    category: string,\n    summary: string,\n    structuredData?: Record<string, unknown>\n  ): string {\n    const parts = [\n      `domain: ${domain}`,\n      path ? `path: ${path}` : '',\n      `category: ${category}`,\n      summary,\n    ];\n\n    // Add key-value pairs from structured data\n    if (structuredData) {\n      for (const [key, value] of Object.entries(structuredData)) {\n        if (value !== undefined && value !== null) {\n          parts.push(`${key}: ${String(value)}`);\n        }\n      }\n    }\n\n    return parts.filter(Boolean).join(' | ');\n  }\n}\n","import { QdrantClient } from '@qdrant/js-client-rest';\nimport type { QdrantConfig, EmbeddingConfig } from '../schemas/config.js';\nimport type { StoredObservation, ObservationCategory, ObservationStatus } from '../schemas/observation.js';\n\nexport interface VectorSearchResult {\n  id: string;\n  score: number;\n  observation_id: string;\n}\n\nexport interface VectorSearchFilters {\n  domain?: string;\n  category?: ObservationCategory;\n  status?: ObservationStatus;\n  min_confidence?: number;\n}\n\n/**\n * Qdrant client wrapper for vector operations\n */\nexport class QdrantStorage {\n  private client: QdrantClient;\n  private collectionName: string;\n  private dimension: number;\n  private initialized: boolean = false;\n\n  constructor(qdrantConfig: QdrantConfig, embeddingConfig: EmbeddingConfig) {\n    this.client = new QdrantClient({\n      url: qdrantConfig.url,\n      apiKey: qdrantConfig.api_key,\n    });\n    this.collectionName = qdrantConfig.collection_name;\n    this.dimension = embeddingConfig.dimension;\n  }\n\n  /**\n   * Initialize the collection if it doesn't exist\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) return;\n\n    try {\n      // Check if collection exists\n      const collections = await this.client.getCollections();\n      const exists = collections.collections.some(c => c.name === this.collectionName);\n\n      if (!exists) {\n        // Create collection with appropriate settings\n        await this.client.createCollection(this.collectionName, {\n          vectors: {\n            size: this.dimension,\n            distance: 'Cosine',\n          },\n          optimizers_config: {\n            default_segment_number: 2,\n          },\n          replication_factor: 1,\n        });\n\n        // Create payload indices for filtering\n        await this.client.createPayloadIndex(this.collectionName, {\n          field_name: 'domain',\n          field_schema: 'keyword',\n        });\n\n        await this.client.createPayloadIndex(this.collectionName, {\n          field_name: 'category',\n          field_schema: 'keyword',\n        });\n\n        await this.client.createPayloadIndex(this.collectionName, {\n          field_name: 'status',\n          field_schema: 'keyword',\n        });\n\n        await this.client.createPayloadIndex(this.collectionName, {\n          field_name: 'confidence',\n          field_schema: 'float',\n        });\n      }\n\n      this.initialized = true;\n    } catch (error) {\n      // If Qdrant is not available, log warning but don't fail\n      console.warn('Qdrant initialization failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check if Qdrant is available\n   */\n  async isAvailable(): Promise<boolean> {\n    try {\n      await this.client.getCollections();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Insert or update a vector point\n   */\n  async upsert(\n    vectorId: string,\n    embedding: number[],\n    observation: StoredObservation\n  ): Promise<void> {\n    await this.initialize();\n\n    await this.client.upsert(this.collectionName, {\n      wait: true,\n      points: [\n        {\n          id: vectorId,\n          vector: embedding,\n          payload: {\n            observation_id: observation.id,\n            domain: observation.domain,\n            path: observation.path,\n            category: observation.category,\n            status: observation.status,\n            confidence: observation.confidence,\n            summary: observation.summary,\n            created_at: observation.created_at,\n          },\n        },\n      ],\n    });\n  }\n\n  /**\n   * Batch upsert multiple vectors\n   */\n  async upsertBatch(\n    items: Array<{ vectorId: string; embedding: number[]; observation: StoredObservation }>\n  ): Promise<void> {\n    await this.initialize();\n\n    const points = items.map(item => ({\n      id: item.vectorId,\n      vector: item.embedding,\n      payload: {\n        observation_id: item.observation.id,\n        domain: item.observation.domain,\n        path: item.observation.path,\n        category: item.observation.category,\n        status: item.observation.status,\n        confidence: item.observation.confidence,\n        summary: item.observation.summary,\n        created_at: item.observation.created_at,\n      },\n    }));\n\n    await this.client.upsert(this.collectionName, {\n      wait: true,\n      points,\n    });\n  }\n\n  /**\n   * Search for similar vectors with optional filters\n   */\n  async search(\n    queryEmbedding: number[],\n    limit: number,\n    filters?: VectorSearchFilters\n  ): Promise<VectorSearchResult[]> {\n    await this.initialize();\n\n    // Build filter conditions\n    const must: Array<Record<string, unknown>> = [];\n\n    if (filters?.domain) {\n      must.push({\n        key: 'domain',\n        match: { value: filters.domain },\n      });\n    }\n\n    if (filters?.category) {\n      must.push({\n        key: 'category',\n        match: { value: filters.category },\n      });\n    }\n\n    if (filters?.status) {\n      must.push({\n        key: 'status',\n        match: { value: filters.status },\n      });\n    }\n\n    if (filters?.min_confidence !== undefined) {\n      must.push({\n        key: 'confidence',\n        range: { gte: filters.min_confidence },\n      });\n    }\n\n    const filter = must.length > 0 ? { must } : undefined;\n\n    const results = await this.client.search(this.collectionName, {\n      vector: queryEmbedding,\n      limit,\n      filter,\n      with_payload: true,\n    });\n\n    return results.map(result => ({\n      id: result.id as string,\n      score: result.score,\n      observation_id: (result.payload as Record<string, unknown>)['observation_id'] as string,\n    }));\n  }\n\n  /**\n   * Delete a vector point\n   */\n  async delete(vectorId: string): Promise<void> {\n    await this.initialize();\n\n    await this.client.delete(this.collectionName, {\n      wait: true,\n      points: [vectorId],\n    });\n  }\n\n  /**\n   * Get collection info\n   */\n  async getCollectionInfo(): Promise<{ points_count: number } | null> {\n    try {\n      await this.initialize();\n      const info = await this.client.getCollection(this.collectionName);\n      return {\n        points_count: info.points_count ?? 0,\n      };\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Update payload for an existing point\n   */\n  async updatePayload(\n    vectorId: string,\n    updates: Partial<{ status: string; confidence: number }>\n  ): Promise<void> {\n    await this.initialize();\n\n    await this.client.setPayload(this.collectionName, {\n      wait: true,\n      points: [vectorId],\n      payload: updates,\n    });\n  }\n}\n","import { randomUUID } from 'node:crypto';\n\n/**\n * Generate a unique observation ID (UUID v4)\n */\nexport function generateObservationId(): string {\n  return randomUUID();\n}\n\n/**\n * Generate a unique vector point ID for Qdrant\n * Uses UUID v4 format which Qdrant accepts\n */\nexport function generateVectorId(): string {\n  return randomUUID();\n}\n\n/**\n * Generate a sync batch ID\n */\nexport function generateSyncBatchId(): string {\n  const timestamp = Date.now().toString(36);\n  const random = randomUUID().slice(0, 8);\n  return `sync_${timestamp}_${random}`;\n}\n","import { EmbeddingGenerator } from './embeddings.js';\nimport { QdrantStorage, type VectorSearchFilters, type VectorSearchResult } from './qdrant.js';\nimport type { StoredObservation } from '../schemas/observation.js';\nimport type { SubstrateConfig } from '../schemas/config.js';\nimport { generateVectorId } from '../utils/id-generator.js';\n\nexport interface VectorSearchOptions extends VectorSearchFilters {\n  limit?: number;\n}\n\n/**\n * Vector search facade coordinating embeddings and Qdrant\n */\nexport class VectorSearch {\n  private embeddings: EmbeddingGenerator;\n  private qdrant: QdrantStorage;\n  private initialized: boolean = false;\n  private available: boolean = false;\n\n  constructor(config: SubstrateConfig) {\n    const embeddingConfig = config.embedding ?? {\n      model: 'Xenova/all-MiniLM-L6-v2',\n      dimension: 384,\n      batch_size: 32,\n    };\n\n    const qdrantConfig = config.qdrant ?? {\n      url: 'http://localhost:6333',\n      collection_name: 'substrate_observations',\n    };\n\n    this.embeddings = new EmbeddingGenerator(embeddingConfig);\n    this.qdrant = new QdrantStorage(qdrantConfig, embeddingConfig);\n  }\n\n  /**\n   * Initialize vector search components\n   */\n  async initialize(): Promise<boolean> {\n    if (this.initialized) return this.available;\n\n    try {\n      // Check Qdrant availability first\n      this.available = await this.qdrant.isAvailable();\n\n      if (this.available) {\n        // Initialize embedding model and Qdrant collection\n        await Promise.all([\n          this.embeddings.initialize(),\n          this.qdrant.initialize(),\n        ]);\n      } else {\n        console.warn('Qdrant not available - vector search disabled');\n      }\n\n      this.initialized = true;\n      return this.available;\n    } catch (error) {\n      console.warn('Vector search initialization failed:', error);\n      this.initialized = true;\n      this.available = false;\n      return false;\n    }\n  }\n\n  /**\n   * Check if vector search is available\n   */\n  isAvailable(): boolean {\n    return this.available;\n  }\n\n  /**\n   * Index an observation for vector search\n   * Returns the vector ID if successful\n   */\n  async index(observation: StoredObservation): Promise<string | undefined> {\n    if (!this.available) {\n      await this.initialize();\n      if (!this.available) return undefined;\n    }\n\n    try {\n      const text = EmbeddingGenerator.createSearchableText(\n        observation.domain,\n        observation.path,\n        observation.category,\n        observation.summary,\n        observation.structured_data as Record<string, unknown> | undefined\n      );\n\n      const embedding = await this.embeddings.embed(text);\n      const vectorId = observation.vector_id ?? generateVectorId();\n\n      await this.qdrant.upsert(vectorId, embedding, observation);\n\n      return vectorId;\n    } catch (error) {\n      console.warn('Vector indexing failed:', error);\n      return undefined;\n    }\n  }\n\n  /**\n   * Index multiple observations in batch\n   */\n  async indexBatch(observations: StoredObservation[]): Promise<Map<string, string>> {\n    const results = new Map<string, string>();\n\n    if (!this.available) {\n      await this.initialize();\n      if (!this.available) return results;\n    }\n\n    try {\n      // Generate texts for embedding\n      const texts = observations.map(obs =>\n        EmbeddingGenerator.createSearchableText(\n          obs.domain,\n          obs.path,\n          obs.category,\n          obs.summary,\n          obs.structured_data as Record<string, unknown> | undefined\n        )\n      );\n\n      // Batch embed\n      const embeddings = await this.embeddings.embedBatch(texts);\n\n      // Prepare items for upsert\n      const items = observations.map((obs, i) => {\n        const vectorId = obs.vector_id ?? generateVectorId();\n        results.set(obs.id, vectorId);\n        return {\n          vectorId,\n          embedding: embeddings[i]!,\n          observation: obs,\n        };\n      });\n\n      // Batch upsert\n      await this.qdrant.upsertBatch(items);\n\n      return results;\n    } catch (error) {\n      console.warn('Batch vector indexing failed:', error);\n      return results;\n    }\n  }\n\n  /**\n   * Search for similar observations\n   */\n  async search(\n    query: string,\n    options: VectorSearchOptions = {}\n  ): Promise<{ results: VectorSearchResult[]; embedding_time_ms: number; search_time_ms: number }> {\n    if (!this.available) {\n      await this.initialize();\n      if (!this.available) {\n        return { results: [], embedding_time_ms: 0, search_time_ms: 0 };\n      }\n    }\n\n    const embedStart = Date.now();\n    const queryEmbedding = await this.embeddings.embed(query);\n    const embedding_time_ms = Date.now() - embedStart;\n\n    const searchStart = Date.now();\n    const results = await this.qdrant.search(\n      queryEmbedding,\n      options.limit ?? 10,\n      {\n        domain: options.domain,\n        category: options.category,\n        status: options.status,\n        min_confidence: options.min_confidence,\n      }\n    );\n    const search_time_ms = Date.now() - searchStart;\n\n    return { results, embedding_time_ms, search_time_ms };\n  }\n\n  /**\n   * Update vector payload (e.g., when observation status changes)\n   */\n  async updatePayload(\n    vectorId: string,\n    updates: { status?: string; confidence?: number }\n  ): Promise<void> {\n    if (!this.available) return;\n\n    try {\n      await this.qdrant.updatePayload(vectorId, updates);\n    } catch (error) {\n      console.warn('Vector payload update failed:', error);\n    }\n  }\n\n  /**\n   * Delete a vector\n   */\n  async delete(vectorId: string): Promise<void> {\n    if (!this.available) return;\n\n    try {\n      await this.qdrant.delete(vectorId);\n    } catch (error) {\n      console.warn('Vector deletion failed:', error);\n    }\n  }\n\n  /**\n   * Get vector index statistics\n   */\n  async getStats(): Promise<{ points_count: number } | null> {\n    if (!this.available) return null;\n\n    try {\n      return await this.qdrant.getCollectionInfo();\n    } catch {\n      return null;\n    }\n  }\n}\n\nexport { EmbeddingGenerator } from './embeddings.js';\nexport { QdrantStorage } from './qdrant.js';\nexport type { VectorSearchResult, VectorSearchFilters } from './qdrant.js';\n","import type { Storage } from '../storage/index.js';\nimport type { StoredObservation } from '../schemas/observation.js';\nimport type { ConfirmationConfig } from '../schemas/config.js';\nimport { generateContentHash } from '../utils/hash.js';\n\nexport interface AggregationResult {\n  isNew: boolean;\n  groupId: number;\n  canonicalObservationId: string;\n  totalConfirmations: number;\n  uniqueAgentCount: number;\n}\n\n/**\n * Groups observations by their content for confirmation tracking\n */\nexport class Aggregator {\n  private storage: Storage;\n  private config: ConfirmationConfig;\n\n  constructor(storage: Storage, config: ConfirmationConfig) {\n    this.storage = storage;\n    this.config = config;\n  }\n\n  /**\n   * Process a new observation and aggregate it with existing similar observations\n   */\n  aggregate(observation: StoredObservation): AggregationResult {\n    const contentHash = generateContentHash(\n      observation.domain,\n      observation.path,\n      observation.category,\n      observation.structured_data\n    );\n\n    // Look for existing confirmation group\n    const existingGroup = this.storage.findConfirmationGroup(\n      observation.domain,\n      observation.path,\n      observation.category,\n      contentHash\n    );\n\n    if (existingGroup) {\n      // Check if this agent has already confirmed\n      if (existingGroup.unique_agents.includes(observation.agent_hash)) {\n        // Same agent, same observation - no additional confirmation\n        return {\n          isNew: false,\n          groupId: existingGroup.id,\n          canonicalObservationId: existingGroup.canonical_observation_id,\n          totalConfirmations: existingGroup.total_confirmations,\n          uniqueAgentCount: existingGroup.unique_agents.length,\n        };\n      }\n\n      // New agent confirming existing observation\n      const newAgents = [...existingGroup.unique_agents, observation.agent_hash];\n      const newConfirmations = existingGroup.total_confirmations + 1;\n\n      this.storage.updateConfirmationGroup(existingGroup.id, {\n        total_confirmations: newConfirmations,\n        unique_agents: newAgents,\n      });\n\n      return {\n        isNew: false,\n        groupId: existingGroup.id,\n        canonicalObservationId: existingGroup.canonical_observation_id,\n        totalConfirmations: newConfirmations,\n        uniqueAgentCount: newAgents.length,\n      };\n    }\n\n    // Create new confirmation group\n    const newGroup = this.storage.createConfirmationGroup(\n      observation.domain,\n      observation.path,\n      observation.category,\n      contentHash,\n      observation.id,\n      observation.agent_hash\n    );\n\n    return {\n      isNew: true,\n      groupId: newGroup.id,\n      canonicalObservationId: observation.id,\n      totalConfirmations: 1,\n      uniqueAgentCount: 1,\n    };\n  }\n\n  /**\n   * Get the content hash for an observation\n   */\n  getContentHash(observation: StoredObservation): string {\n    return generateContentHash(\n      observation.domain,\n      observation.path,\n      observation.category,\n      observation.structured_data\n    );\n  }\n}\n","import type { Storage } from '../storage/index.js';\nimport type { ConfirmationConfig } from '../schemas/config.js';\nimport type { ObservationStatus } from '../schemas/observation.js';\nimport type { VectorSearch } from '../vector/index.js';\n\nexport interface PromotionResult {\n  promoted: boolean;\n  newStatus: ObservationStatus;\n  newConfidence: number;\n  message: string;\n}\n\n/**\n * Handles promotion of observations based on confirmation counts\n */\nexport class Promoter {\n  private storage: Storage;\n  private config: ConfirmationConfig;\n  private vectorSearch: VectorSearch | null;\n\n  constructor(storage: Storage, config: ConfirmationConfig, vectorSearch?: VectorSearch) {\n    this.storage = storage;\n    this.config = config;\n    this.vectorSearch = vectorSearch ?? null;\n  }\n\n  /**\n   * Calculate confidence based on confirmation count\n   * confidence = min(1.0, confirmations / (threshold * 2))\n   */\n  calculateConfidence(confirmations: number): number {\n    return Math.min(1.0, confirmations / this.config.confidence_factor);\n  }\n\n  /**\n   * Check and promote observation based on confirmation count\n   */\n  async checkAndPromote(\n    groupId: number,\n    uniqueAgentCount: number,\n    canonicalObservationId: string\n  ): Promise<PromotionResult> {\n    const observation = this.storage.get(canonicalObservationId);\n    if (!observation) {\n      return {\n        promoted: false,\n        newStatus: 'pending',\n        newConfidence: 0,\n        message: 'Observation not found',\n      };\n    }\n\n    const newConfidence = this.calculateConfidence(uniqueAgentCount);\n    const shouldPromote = uniqueAgentCount >= this.config.threshold;\n\n    let newStatus: ObservationStatus = observation.status;\n\n    if (shouldPromote && observation.status === 'pending') {\n      newStatus = 'confirmed';\n    }\n\n    // Update observation\n    this.storage.update(canonicalObservationId, {\n      status: newStatus,\n      confirmations: uniqueAgentCount,\n      confidence: newConfidence,\n    });\n\n    // Update confirmation group\n    this.storage.updateConfirmationGroup(groupId, {\n      status: newStatus,\n      confidence: newConfidence,\n    });\n\n    // Update vector payload if available\n    if (this.vectorSearch && observation.vector_id) {\n      await this.vectorSearch.updatePayload(observation.vector_id, {\n        status: newStatus,\n        confidence: newConfidence,\n      });\n    }\n\n    const promoted = newStatus === 'confirmed' && observation.status === 'pending';\n\n    return {\n      promoted,\n      newStatus,\n      newConfidence,\n      message: promoted\n        ? `Observation promoted to confirmed (${uniqueAgentCount} unique agents)`\n        : `Observation updated (${uniqueAgentCount}/${this.config.threshold} confirmations)`,\n    };\n  }\n\n  /**\n   * Manually confirm an observation (admin action)\n   */\n  async manualConfirm(observationId: string, reason?: string): Promise<PromotionResult> {\n    const observation = this.storage.get(observationId);\n    if (!observation) {\n      return {\n        promoted: false,\n        newStatus: 'pending',\n        newConfidence: 0,\n        message: 'Observation not found',\n      };\n    }\n\n    this.storage.update(observationId, {\n      status: 'confirmed',\n      confidence: 1.0,\n    });\n\n    // Update vector payload if available\n    if (this.vectorSearch && observation.vector_id) {\n      await this.vectorSearch.updatePayload(observation.vector_id, {\n        status: 'confirmed',\n        confidence: 1.0,\n      });\n    }\n\n    return {\n      promoted: true,\n      newStatus: 'confirmed',\n      newConfidence: 1.0,\n      message: reason ? `Manually confirmed: ${reason}` : 'Manually confirmed by admin',\n    };\n  }\n\n  /**\n   * Mark an observation as stale\n   */\n  async markStale(observationId: string, reason?: string): Promise<PromotionResult> {\n    const observation = this.storage.get(observationId);\n    if (!observation) {\n      return {\n        promoted: false,\n        newStatus: 'pending',\n        newConfidence: 0,\n        message: 'Observation not found',\n      };\n    }\n\n    this.storage.update(observationId, {\n      status: 'stale',\n    });\n\n    // Update vector payload if available\n    if (this.vectorSearch && observation.vector_id) {\n      await this.vectorSearch.updatePayload(observation.vector_id, {\n        status: 'stale',\n      });\n    }\n\n    return {\n      promoted: false,\n      newStatus: 'stale',\n      newConfidence: observation.confidence,\n      message: reason ? `Marked stale: ${reason}` : 'Marked as stale',\n    };\n  }\n\n  /**\n   * Reject an observation (mark as contradicted)\n   */\n  async reject(observationId: string, reason?: string): Promise<PromotionResult> {\n    const observation = this.storage.get(observationId);\n    if (!observation) {\n      return {\n        promoted: false,\n        newStatus: 'pending',\n        newConfidence: 0,\n        message: 'Observation not found',\n      };\n    }\n\n    this.storage.update(observationId, {\n      status: 'contradicted',\n      confidence: 0,\n    });\n\n    // Update vector payload if available\n    if (this.vectorSearch && observation.vector_id) {\n      await this.vectorSearch.updatePayload(observation.vector_id, {\n        status: 'contradicted',\n        confidence: 0,\n      });\n    }\n\n    return {\n      promoted: false,\n      newStatus: 'contradicted',\n      newConfidence: 0,\n      message: reason ? `Rejected: ${reason}` : 'Rejected',\n    };\n  }\n}\n","import type { Storage } from '../storage/index.js';\nimport type { StoredObservation } from '../schemas/observation.js';\nimport type { ConfirmationConfig } from '../schemas/config.js';\n\nexport interface ContradictionResult {\n  hasContradiction: boolean;\n  contradictingObservations: string[];\n  message: string;\n}\n\n/**\n * Detects contradictions between observations\n */\nexport class ContradictionDetector {\n  private storage: Storage;\n  private config: ConfirmationConfig;\n\n  constructor(storage: Storage, config: ConfirmationConfig) {\n    this.storage = storage;\n    this.config = config;\n  }\n\n  /**\n   * Check for contradictions with existing observations\n   * Looks for observations with same domain/path/category but different structured_data\n   */\n  detectContradictions(observation: StoredObservation): ContradictionResult {\n    // Get recent observations for same domain/path/category\n    const windowStart = new Date(\n      Date.now() - this.config.contradiction_window_hours * 60 * 60 * 1000\n    ).toISOString();\n\n    const existing = this.storage.query({\n      domain: observation.domain,\n      path: observation.path,\n      category: observation.category,\n      since: windowStart,\n      limit: 50,\n    });\n\n    const contradictions: string[] = [];\n\n    for (const existing_obs of existing) {\n      // Skip self\n      if (existing_obs.id === observation.id) continue;\n\n      // Skip already contradicted or stale observations\n      if (existing_obs.status === 'contradicted' || existing_obs.status === 'stale') continue;\n\n      // Check if structured data conflicts\n      if (this.dataConflicts(observation.structured_data, existing_obs.structured_data)) {\n        contradictions.push(existing_obs.id);\n      }\n    }\n\n    if (contradictions.length > 0) {\n      return {\n        hasContradiction: true,\n        contradictingObservations: contradictions,\n        message: `Found ${contradictions.length} potentially contradicting observation(s)`,\n      };\n    }\n\n    return {\n      hasContradiction: false,\n      contradictingObservations: [],\n      message: 'No contradictions detected',\n    };\n  }\n\n  /**\n   * Mark observations as contradicted\n   */\n  markAsContradicted(observationIds: string[]): void {\n    for (const id of observationIds) {\n      this.storage.update(id, {\n        status: 'contradicted',\n      });\n    }\n  }\n\n  /**\n   * Check if two structured data objects conflict\n   */\n  private dataConflicts(\n    data1: unknown,\n    data2: unknown\n  ): boolean {\n    // If both are null/undefined, no conflict\n    if (!data1 && !data2) return false;\n\n    // If one is null/undefined and other isn't, not necessarily a conflict\n    if (!data1 || !data2) return false;\n\n    // Both must be objects\n    if (typeof data1 !== 'object' || typeof data2 !== 'object') return false;\n\n    const obj1 = data1 as Record<string, unknown>;\n    const obj2 = data2 as Record<string, unknown>;\n\n    // Check for conflicting values on same keys\n    for (const key of Object.keys(obj1)) {\n      if (key in obj2) {\n        const val1 = obj1[key];\n        const val2 = obj2[key];\n\n        // Skip undefined/null values\n        if (val1 === undefined || val1 === null) continue;\n        if (val2 === undefined || val2 === null) continue;\n\n        // Different non-null values = conflict\n        if (JSON.stringify(val1) !== JSON.stringify(val2)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n}\n","import type { VectorSearch } from '../vector/index.js';\nimport type { StoredObservation } from '../schemas/observation.js';\n\nexport interface FuzzyMatchResult {\n  matched: boolean;\n  matchedObservationId: string | null;\n  similarity: number;\n}\n\n/**\n * v0.3: Fuzzy structural matching using vector similarity\n * Groups \"similar enough\" observations for confirmation\n */\nexport class FuzzyMatcher {\n  private vectorSearch: VectorSearch;\n  private similarityThreshold: number;\n\n  constructor(vectorSearch: VectorSearch, similarityThreshold: number = 0.85) {\n    this.vectorSearch = vectorSearch;\n    this.similarityThreshold = similarityThreshold;\n  }\n\n  /**\n   * Find a fuzzy match for an observation\n   */\n  async findMatch(observation: StoredObservation): Promise<FuzzyMatchResult> {\n    if (!this.vectorSearch.isAvailable()) {\n      return {\n        matched: false,\n        matchedObservationId: null,\n        similarity: 0,\n      };\n    }\n\n    const searchText = `${observation.domain} ${observation.path ?? ''} ${observation.category} ${observation.summary}`;\n\n    const { results } = await this.vectorSearch.search(searchText, {\n      domain: observation.domain,\n      category: observation.category,\n      limit: 5,\n    });\n\n    // Find the best match above threshold\n    for (const result of results) {\n      // Skip self\n      if (result.observation_id === observation.id) continue;\n\n      if (result.score >= this.similarityThreshold) {\n        return {\n          matched: true,\n          matchedObservationId: result.observation_id,\n          similarity: result.score,\n        };\n      }\n    }\n\n    return {\n      matched: false,\n      matchedObservationId: null,\n      similarity: results[0]?.score ?? 0,\n    };\n  }\n\n  /**\n   * Set the similarity threshold\n   */\n  setThreshold(threshold: number): void {\n    this.similarityThreshold = Math.max(0, Math.min(1, threshold));\n  }\n\n  /**\n   * Get the current similarity threshold\n   */\n  getThreshold(): number {\n    return this.similarityThreshold;\n  }\n}\n","import { Aggregator, type AggregationResult } from './aggregator.js';\nimport { Promoter, type PromotionResult } from './promoter.js';\nimport { ContradictionDetector, type ContradictionResult } from './contradiction.js';\nimport { FuzzyMatcher } from './fuzzy-matcher.js';\nimport type { Storage } from '../storage/index.js';\nimport type { StoredObservation, ObservationStatus } from '../schemas/observation.js';\nimport type { ConfirmationConfig } from '../schemas/config.js';\nimport type { VectorSearch } from '../vector/index.js';\n\nexport interface ProcessObservationResult {\n  aggregation: AggregationResult;\n  promotion: PromotionResult;\n  contradiction: ContradictionResult;\n}\n\n/**\n * N-confirmation engine that coordinates aggregation, promotion, and contradiction detection\n */\nexport class ConfirmationEngine {\n  private aggregator: Aggregator;\n  private promoter: Promoter;\n  private contradictionDetector: ContradictionDetector;\n  private fuzzyMatcher: FuzzyMatcher | null = null;\n  private config: ConfirmationConfig;\n\n  constructor(\n    storage: Storage,\n    config: ConfirmationConfig,\n    vectorSearch?: VectorSearch\n  ) {\n    this.config = config;\n    this.aggregator = new Aggregator(storage, config);\n    this.promoter = new Promoter(storage, config, vectorSearch);\n    this.contradictionDetector = new ContradictionDetector(storage, config);\n\n    if (vectorSearch) {\n      this.fuzzyMatcher = new FuzzyMatcher(vectorSearch);\n    }\n  }\n\n  /**\n   * Process a new observation through the confirmation pipeline\n   */\n  async processObservation(observation: StoredObservation): Promise<ProcessObservationResult> {\n    // Step 1: Detect contradictions\n    const contradiction = this.contradictionDetector.detectContradictions(observation);\n\n    // If contradictions found, mark old observations\n    if (contradiction.hasContradiction) {\n      this.contradictionDetector.markAsContradicted(contradiction.contradictingObservations);\n    }\n\n    // Step 2: Aggregate with existing observations\n    const aggregation = this.aggregator.aggregate(observation);\n\n    // Step 3: Check for promotion\n    const promotion = await this.promoter.checkAndPromote(\n      aggregation.groupId,\n      aggregation.uniqueAgentCount,\n      aggregation.canonicalObservationId\n    );\n\n    return {\n      aggregation,\n      promotion,\n      contradiction,\n    };\n  }\n\n  /**\n   * Manually confirm an observation (admin action)\n   */\n  async manualConfirm(observationId: string, reason?: string): Promise<PromotionResult> {\n    return this.promoter.manualConfirm(observationId, reason);\n  }\n\n  /**\n   * Manually reject an observation\n   */\n  async reject(observationId: string, reason?: string): Promise<PromotionResult> {\n    return this.promoter.reject(observationId, reason);\n  }\n\n  /**\n   * Mark an observation as stale\n   */\n  async markStale(observationId: string, reason?: string): Promise<PromotionResult> {\n    return this.promoter.markStale(observationId, reason);\n  }\n\n  /**\n   * Get content hash for an observation\n   */\n  getContentHash(observation: StoredObservation): string {\n    return this.aggregator.getContentHash(observation);\n  }\n\n  /**\n   * Get the confirmation threshold\n   */\n  getThreshold(): number {\n    return this.config.threshold;\n  }\n\n  /**\n   * Calculate confidence for a given confirmation count\n   */\n  calculateConfidence(confirmations: number): number {\n    return this.promoter.calculateConfidence(confirmations);\n  }\n\n  /**\n   * v0.3: Find fuzzy matches for an observation\n   */\n  async findFuzzyMatch(observation: StoredObservation): Promise<{ matched: boolean; matchedId: string | null; similarity: number }> {\n    if (!this.fuzzyMatcher) {\n      return { matched: false, matchedId: null, similarity: 0 };\n    }\n\n    const result = await this.fuzzyMatcher.findMatch(observation);\n    return {\n      matched: result.matched,\n      matchedId: result.matchedObservationId,\n      similarity: result.similarity,\n    };\n  }\n}\n\nexport { Aggregator } from './aggregator.js';\nexport { Promoter } from './promoter.js';\nexport { ContradictionDetector } from './contradiction.js';\nexport { FuzzyMatcher } from './fuzzy-matcher.js';\nexport type { AggregationResult, PromotionResult, ContradictionResult };\n","import { writeFileSync, readFileSync, readdirSync, unlinkSync, existsSync, mkdirSync } from 'node:fs';\nimport { join, basename } from 'node:path';\nimport type { StoredObservation } from '../schemas/observation.js';\nimport { generateSyncBatchId } from '../utils/id-generator.js';\n\nexport interface SyncBatch {\n  id: string;\n  created_at: string;\n  observations: StoredObservation[];\n}\n\n/**\n * File-based transport for peer sync\n */\nexport class FileTransport {\n  private outboxPath: string;\n\n  constructor(outboxPath: string) {\n    this.outboxPath = outboxPath;\n    this.ensureDir(outboxPath);\n  }\n\n  /**\n   * Write observations to outbox for other peers to pick up\n   */\n  writeToOutbox(observations: StoredObservation[]): string {\n    if (observations.length === 0) return '';\n\n    const batch: SyncBatch = {\n      id: generateSyncBatchId(),\n      created_at: new Date().toISOString(),\n      observations,\n    };\n\n    const filename = `${batch.id}.json`;\n    const filepath = join(this.outboxPath, filename);\n\n    writeFileSync(filepath, JSON.stringify(batch, null, 2), 'utf8');\n\n    return batch.id;\n  }\n\n  /**\n   * Read sync batches from a peer's outbox\n   */\n  readFromPeerOutbox(peerOutboxPath: string, afterBatchId?: string): SyncBatch[] {\n    if (!existsSync(peerOutboxPath)) {\n      return [];\n    }\n\n    const files = readdirSync(peerOutboxPath)\n      .filter(f => f.endsWith('.json'))\n      .sort(); // Sort by filename (which includes timestamp)\n\n    const batches: SyncBatch[] = [];\n    let foundAfterBatch = !afterBatchId;\n\n    for (const file of files) {\n      const batchId = basename(file, '.json');\n\n      if (!foundAfterBatch) {\n        if (batchId === afterBatchId) {\n          foundAfterBatch = true;\n        }\n        continue;\n      }\n\n      try {\n        const content = readFileSync(join(peerOutboxPath, file), 'utf8');\n        const batch = JSON.parse(content) as SyncBatch;\n        batches.push(batch);\n      } catch (error) {\n        console.warn(`Failed to read sync batch ${file}:`, error);\n      }\n    }\n\n    return batches;\n  }\n\n  /**\n   * Get the latest batch ID from outbox\n   */\n  getLatestBatchId(): string | null {\n    if (!existsSync(this.outboxPath)) {\n      return null;\n    }\n\n    const files = readdirSync(this.outboxPath)\n      .filter(f => f.endsWith('.json'))\n      .sort();\n\n    if (files.length === 0) return null;\n\n    return basename(files[files.length - 1]!, '.json');\n  }\n\n  /**\n   * Clean up old batches from outbox\n   */\n  cleanupOldBatches(maxAgeMs: number = 7 * 24 * 60 * 60 * 1000): number {\n    if (!existsSync(this.outboxPath)) {\n      return 0;\n    }\n\n    const files = readdirSync(this.outboxPath).filter(f => f.endsWith('.json'));\n    const now = Date.now();\n    let cleaned = 0;\n\n    for (const file of files) {\n      try {\n        const filepath = join(this.outboxPath, file);\n        const content = readFileSync(filepath, 'utf8');\n        const batch = JSON.parse(content) as SyncBatch;\n        const createdAt = new Date(batch.created_at).getTime();\n\n        if (now - createdAt > maxAgeMs) {\n          unlinkSync(filepath);\n          cleaned++;\n        }\n      } catch (error) {\n        console.warn(`Failed to check/clean batch ${file}:`, error);\n      }\n    }\n\n    return cleaned;\n  }\n\n  /**\n   * Get outbox path\n   */\n  getOutboxPath(): string {\n    return this.outboxPath;\n  }\n\n  private ensureDir(dirPath: string): void {\n    if (!existsSync(dirPath)) {\n      mkdirSync(dirPath, { recursive: true });\n    }\n  }\n}\n","import type { StoredObservation } from '../schemas/observation.js';\nimport type { FileTransport } from './file-transport.js';\n\n/**\n * Fast-path for urgent signals (failures, critical issues)\n */\nexport class UrgentSignalHandler {\n  private transport: FileTransport;\n  private pendingUrgent: StoredObservation[] = [];\n  private flushTimer: NodeJS.Timeout | null = null;\n  private urgentIntervalMs: number;\n\n  constructor(transport: FileTransport, urgentIntervalMs: number = 5000) {\n    this.transport = transport;\n    this.urgentIntervalMs = urgentIntervalMs;\n  }\n\n  /**\n   * Check if an observation is urgent\n   */\n  isUrgent(observation: StoredObservation): boolean {\n    // Critical urgency\n    if (observation.urgency === 'critical') return true;\n\n    // High urgency errors\n    if (observation.urgency === 'high' && observation.category === 'error') return true;\n\n    // Auth failures are always urgent\n    if (observation.category === 'auth' && observation.structured_data) {\n      const data = observation.structured_data as Record<string, unknown>;\n      if (data['error'] || data['failed']) return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Queue an urgent observation for fast sync\n   */\n  queue(observation: StoredObservation): void {\n    this.pendingUrgent.push(observation);\n\n    // Start flush timer if not already running\n    if (!this.flushTimer) {\n      this.flushTimer = setTimeout(() => this.flush(), this.urgentIntervalMs);\n    }\n  }\n\n  /**\n   * Flush urgent observations immediately\n   */\n  flush(): string | null {\n    if (this.flushTimer) {\n      clearTimeout(this.flushTimer);\n      this.flushTimer = null;\n    }\n\n    if (this.pendingUrgent.length === 0) {\n      return null;\n    }\n\n    const observations = this.pendingUrgent;\n    this.pendingUrgent = [];\n\n    return this.transport.writeToOutbox(observations);\n  }\n\n  /**\n   * Get count of pending urgent observations\n   */\n  getPendingCount(): number {\n    return this.pendingUrgent.length;\n  }\n\n  /**\n   * Stop the urgent handler\n   */\n  stop(): void {\n    if (this.flushTimer) {\n      clearTimeout(this.flushTimer);\n      this.flushTimer = null;\n    }\n    this.pendingUrgent = [];\n  }\n}\n","import { FileTransport, type SyncBatch } from './file-transport.js';\nimport { UrgentSignalHandler } from './urgent.js';\nimport type { Storage } from '../storage/index.js';\nimport type { StoredObservation } from '../schemas/observation.js';\nimport type { SyncConfig, PeerConfig } from '../schemas/config.js';\nimport type { ConfirmationEngine } from '../confirmation/index.js';\nimport type { VectorSearch } from '../vector/index.js';\n\nexport interface SyncResult {\n  peer: string;\n  batchesProcessed: number;\n  observationsImported: number;\n  lastBatchId: string | null;\n}\n\n/**\n * Sync coordinator for peer-to-peer observation sharing\n */\nexport class SyncCoordinator {\n  private storage: Storage;\n  private transport: FileTransport;\n  private urgentHandler: UrgentSignalHandler;\n  private confirmationEngine: ConfirmationEngine | null;\n  private vectorSearch: VectorSearch | null;\n  private config: SyncConfig;\n  private syncTimer: NodeJS.Timeout | null = null;\n  private running: boolean = false;\n\n  constructor(\n    storage: Storage,\n    config: SyncConfig,\n    confirmationEngine?: ConfirmationEngine,\n    vectorSearch?: VectorSearch\n  ) {\n    this.storage = storage;\n    this.config = config;\n    this.transport = new FileTransport(config.outbox_path);\n    this.urgentHandler = new UrgentSignalHandler(this.transport, config.urgent_interval_ms);\n    this.confirmationEngine = confirmationEngine ?? null;\n    this.vectorSearch = vectorSearch ?? null;\n  }\n\n  /**\n   * Start the sync coordinator\n   */\n  start(): void {\n    if (this.running || !this.config.enabled) return;\n\n    this.running = true;\n    this.scheduleSyncCycle();\n  }\n\n  /**\n   * Stop the sync coordinator\n   */\n  stop(): void {\n    this.running = false;\n\n    if (this.syncTimer) {\n      clearTimeout(this.syncTimer);\n      this.syncTimer = null;\n    }\n\n    this.urgentHandler.stop();\n  }\n\n  /**\n   * Export an observation for sync\n   */\n  exportObservation(observation: StoredObservation): void {\n    if (!this.config.enabled) return;\n\n    // Check if urgent\n    if (this.urgentHandler.isUrgent(observation)) {\n      this.urgentHandler.queue(observation);\n    }\n\n    // Regular observations are batched in the periodic sync\n  }\n\n  /**\n   * Flush urgent observations immediately\n   */\n  flushUrgent(): string | null {\n    return this.urgentHandler.flush();\n  }\n\n  /**\n   * Run a sync cycle with all peers\n   */\n  async syncWithPeers(): Promise<SyncResult[]> {\n    const results: SyncResult[] = [];\n\n    for (const peer of this.config.peers) {\n      if (!peer.enabled) continue;\n\n      try {\n        const result = await this.syncWithPeer(peer);\n        results.push(result);\n      } catch (error) {\n        console.warn(`Sync with peer ${peer.name} failed:`, error);\n        results.push({\n          peer: peer.name,\n          batchesProcessed: 0,\n          observationsImported: 0,\n          lastBatchId: null,\n        });\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Sync with a specific peer\n   */\n  async syncWithPeer(peer: PeerConfig): Promise<SyncResult> {\n    // Get last sync state\n    const syncState = this.storage.getSyncState(peer.name);\n    const lastBatchId = syncState?.last_observation_id ?? null;\n\n    // Read new batches from peer\n    const batches = this.transport.readFromPeerOutbox(peer.path, lastBatchId ?? undefined);\n\n    let observationsImported = 0;\n    let lastProcessedBatchId: string | null = null;\n\n    for (const batch of batches) {\n      const imported = await this.importBatch(batch);\n      observationsImported += imported;\n      lastProcessedBatchId = batch.id;\n    }\n\n    // Update sync state\n    if (lastProcessedBatchId) {\n      this.storage.updateSyncState(peer.name, new Date().toISOString(), lastProcessedBatchId);\n    }\n\n    return {\n      peer: peer.name,\n      batchesProcessed: batches.length,\n      observationsImported,\n      lastBatchId: lastProcessedBatchId,\n    };\n  }\n\n  /**\n   * Import a sync batch\n   */\n  private async importBatch(batch: SyncBatch): Promise<number> {\n    let imported = 0;\n\n    for (const observation of batch.observations) {\n      try {\n        // Check if observation already exists\n        const existing = this.storage.get(observation.id);\n        if (existing) continue;\n\n        // Insert observation\n        this.storage.insert(observation);\n\n        // Index in vector search\n        if (this.vectorSearch) {\n          const vectorId = await this.vectorSearch.index(observation);\n          if (vectorId) {\n            this.storage.update(observation.id, { vector_id: vectorId });\n          }\n        }\n\n        // Process through confirmation engine\n        if (this.confirmationEngine) {\n          await this.confirmationEngine.processObservation(observation);\n        }\n\n        imported++;\n      } catch (error) {\n        console.warn(`Failed to import observation ${observation.id}:`, error);\n      }\n    }\n\n    return imported;\n  }\n\n  /**\n   * Export pending observations to outbox\n   */\n  exportPendingObservations(): string | null {\n    // Get observations since last export\n    const lastBatchId = this.transport.getLatestBatchId();\n    const observations = this.storage.readJSONLSince(lastBatchId);\n\n    if (observations.length === 0) return null;\n\n    return this.transport.writeToOutbox(observations);\n  }\n\n  /**\n   * Schedule the next sync cycle\n   */\n  private scheduleSyncCycle(): void {\n    if (!this.running) return;\n\n    this.syncTimer = setTimeout(async () => {\n      try {\n        // Export our observations\n        this.exportPendingObservations();\n\n        // Import from peers\n        await this.syncWithPeers();\n\n        // Cleanup old batches\n        this.transport.cleanupOldBatches();\n      } catch (error) {\n        console.warn('Sync cycle failed:', error);\n      }\n\n      // Schedule next cycle\n      this.scheduleSyncCycle();\n    }, this.config.interval_ms);\n  }\n\n  /**\n   * Get the outbox path\n   */\n  getOutboxPath(): string {\n    return this.transport.getOutboxPath();\n  }\n\n  /**\n   * Check if sync is running\n   */\n  isRunning(): boolean {\n    return this.running;\n  }\n\n  /**\n   * Get peer configurations\n   */\n  getPeers(): PeerConfig[] {\n    return this.config.peers;\n  }\n}\n\nexport { FileTransport } from './file-transport.js';\nexport { UrgentSignalHandler } from './urgent.js';\nexport type { SyncBatch } from './file-transport.js';\n","import { z } from 'zod';\n\n// Peer configuration for sync\nexport const PeerConfig = z.object({\n  name: z.string(),\n  path: z.string(),                      // Path to peer's outbox directory\n  enabled: z.boolean().default(true),\n});\n\nexport type PeerConfig = z.infer<typeof PeerConfig>;\n\n// Qdrant configuration\nexport const QdrantConfig = z.object({\n  url: z.string().url().default('http://localhost:6333'),\n  collection_name: z.string().default('substrate_observations'),\n  api_key: z.string().optional(),\n});\n\nexport type QdrantConfig = z.infer<typeof QdrantConfig>;\n\n// Confirmation engine configuration\nexport const ConfirmationConfig = z.object({\n  threshold: z.number().min(1).default(3),           // N confirmations needed\n  confidence_factor: z.number().min(1).default(6),   // Divisor for confidence calculation\n  contradiction_window_hours: z.number().default(24), // Window for contradiction detection\n  stale_after_days: z.number().default(30),          // Mark as stale after N days\n});\n\nexport type ConfirmationConfig = z.infer<typeof ConfirmationConfig>;\n\n// Sync configuration\nexport const SyncConfig = z.object({\n  enabled: z.boolean().default(true),\n  interval_ms: z.number().default(60000),           // 1 minute default\n  urgent_interval_ms: z.number().default(5000),     // 5 seconds for urgent\n  outbox_path: z.string(),\n  peers: z.array(PeerConfig).default([]),\n});\n\nexport type SyncConfig = z.infer<typeof SyncConfig>;\n\n// Embedding model configuration\nexport const EmbeddingConfig = z.object({\n  model: z.string().default('Xenova/all-MiniLM-L6-v2'),\n  dimension: z.number().default(384),\n  batch_size: z.number().default(32),\n});\n\nexport type EmbeddingConfig = z.infer<typeof EmbeddingConfig>;\n\n// Main configuration schema\nexport const SubstrateConfig = z.object({\n  // Data paths\n  data_dir: z.string(),\n  sqlite_path: z.string().optional(),\n  jsonl_path: z.string().optional(),\n\n  // Agent identity\n  agent_id: z.string().optional(),       // Will be hashed for privacy\n\n  // Feature configurations\n  qdrant: QdrantConfig.optional(),\n  confirmation: ConfirmationConfig.optional(),\n  sync: SyncConfig.optional(),\n  embedding: EmbeddingConfig.optional(),\n\n  // Logging\n  log_level: z.enum(['debug', 'info', 'warn', 'error']).default('info'),\n});\n\nexport type SubstrateConfig = z.infer<typeof SubstrateConfig>;\n\n// Default configuration factory\nexport function createDefaultConfig(dataDir: string): SubstrateConfig {\n  return {\n    data_dir: dataDir,\n    sqlite_path: `${dataDir}/substrate.db`,\n    jsonl_path: `${dataDir}/observations.jsonl`,\n    qdrant: {\n      url: 'http://localhost:6333',\n      collection_name: 'substrate_observations',\n    },\n    confirmation: {\n      threshold: 3,\n      confidence_factor: 6,\n      contradiction_window_hours: 24,\n      stale_after_days: 30,\n    },\n    sync: {\n      enabled: true,\n      interval_ms: 60000,\n      urgent_interval_ms: 5000,\n      outbox_path: `${dataDir}/outbox`,\n      peers: [],\n    },\n    embedding: {\n      model: 'Xenova/all-MiniLM-L6-v2',\n      dimension: 384,\n      batch_size: 32,\n    },\n    log_level: 'info',\n  };\n}\n\n// Environment variable overrides\nexport function configFromEnv(baseConfig: SubstrateConfig): SubstrateConfig {\n  const env = process.env;\n\n  return {\n    ...baseConfig,\n    data_dir: env['SUBSTRATE_DATA_DIR'] ?? baseConfig.data_dir,\n    agent_id: env['SUBSTRATE_AGENT_ID'] ?? baseConfig.agent_id,\n    log_level: (env['SUBSTRATE_LOG_LEVEL'] as SubstrateConfig['log_level']) ?? baseConfig.log_level,\n    qdrant: {\n      ...baseConfig.qdrant,\n      url: env['SUBSTRATE_QDRANT_URL'] ?? baseConfig.qdrant?.url ?? 'http://localhost:6333',\n      collection_name: env['SUBSTRATE_QDRANT_COLLECTION'] ?? baseConfig.qdrant?.collection_name ?? 'substrate_observations',\n      api_key: env['SUBSTRATE_QDRANT_API_KEY'] ?? baseConfig.qdrant?.api_key,\n    },\n  };\n}\n","export interface Logger {\n  debug(message: string, ...args: unknown[]): void;\n  info(message: string, ...args: unknown[]): void;\n  warn(message: string, ...args: unknown[]): void;\n  error(message: string, ...args: unknown[]): void;\n}\n\nexport const createConsoleLogger = (level: 'debug' | 'info' | 'warn' | 'error' = 'info'): Logger => {\n  const levels = ['debug', 'info', 'warn', 'error'];\n  const minLevel = levels.indexOf(level);\n\n  const shouldLog = (logLevel: string) => levels.indexOf(logLevel) >= minLevel;\n\n  return {\n    debug: (message, ...args) => shouldLog('debug') && console.debug(`[DEBUG] ${message}`, ...args),\n    info: (message, ...args) => shouldLog('info') && console.info(`[INFO] ${message}`, ...args),\n    warn: (message, ...args) => shouldLog('warn') && console.warn(`[WARN] ${message}`, ...args),\n    error: (message, ...args) => shouldLog('error') && console.error(`[ERROR] ${message}`, ...args),\n  };\n};\n","import { z } from 'zod';\n\n// Observation categories\nexport const ObservationCategory = z.enum([\n  'behavior',    // UI/UX patterns, workflows, interactions\n  'error',       // Error messages, failure modes\n  'auth',        // Authentication requirements, session handling\n  'rate_limit',  // Rate limiting, throttling, quotas\n  'format',      // Data formats, validation rules, encoding\n]);\n\nexport type ObservationCategory = z.infer<typeof ObservationCategory>;\n\n// Status of an observation in the confirmation workflow\nexport const ObservationStatus = z.enum([\n  'pending',     // Initial state, awaiting confirmations\n  'confirmed',   // Met confirmation threshold\n  'contradicted', // Conflicting observations detected\n  'stale',       // Marked as outdated\n]);\n\nexport type ObservationStatus = z.infer<typeof ObservationStatus>;\n\n// Urgency level for sync prioritization\nexport const UrgencyLevel = z.enum([\n  'normal',      // Standard sync interval\n  'high',        // Priority sync\n  'critical',    // Immediate sync (failures, auth changes)\n]);\n\nexport type UrgencyLevel = z.infer<typeof UrgencyLevel>;\n\n// Structured data varies by category\nexport const BehaviorData = z.object({\n  element: z.string().optional(),\n  action: z.string().optional(),\n  expected_result: z.string().optional(),\n  actual_result: z.string().optional(),\n  workaround: z.string().optional(),\n});\n\nexport const ErrorData = z.object({\n  error_code: z.string().optional(),\n  error_message: z.string().optional(),\n  trigger: z.string().optional(),\n  resolution: z.string().optional(),\n  recoverable: z.boolean().optional(),\n});\n\nexport const AuthData = z.object({\n  method: z.string().optional(),         // oauth, api_key, session, etc.\n  header: z.string().optional(),          // X-Api-Key, Authorization, etc.\n  token_location: z.string().optional(), // header, cookie, query\n  session_duration: z.string().optional(),\n  refresh_mechanism: z.string().optional(),\n});\n\nexport const RateLimitData = z.object({\n  limit: z.number().optional(),\n  window: z.string().optional(),         // \"1m\", \"1h\", \"1d\"\n  header_remaining: z.string().optional(),\n  header_reset: z.string().optional(),\n  retry_after: z.string().optional(),\n});\n\nexport const FormatData = z.object({\n  field: z.string().optional(),\n  format: z.string().optional(),         // \"DD/MM/YYYY\", \"ISO8601\", etc.\n  validation_regex: z.string().optional(),\n  encoding: z.string().optional(),\n  max_length: z.number().optional(),\n  required: z.boolean().optional(),\n});\n\n// Union of all structured data types\n// Use passthrough to preserve unknown keys when parsing through typed schemas\nexport const StructuredData = z.union([\n  BehaviorData.passthrough(),\n  ErrorData.passthrough(),\n  AuthData.passthrough(),\n  RateLimitData.passthrough(),\n  FormatData.passthrough(),\n  z.record(z.unknown()), // Allow arbitrary data for flexibility\n]);\n\nexport type StructuredData = z.infer<typeof StructuredData>;\n\n// Impact metrics - estimated by the observing agent\nexport const ImpactEstimate = z.object({\n  time_saved_seconds: z.number().min(0).optional(),      // Estimated seconds saved\n  success_rate_improvement: z.number().min(0).max(100).optional(), // % improvement (0-100)\n  reasoning: z.string().optional(),                       // Why this estimate\n});\n\nexport type ImpactEstimate = z.infer<typeof ImpactEstimate>;\n\n// Impact report - reported by an agent that used the advice\nexport const ImpactReport = z.object({\n  agent_hash: z.string(),\n  actual_time_saved_seconds: z.number().optional(),\n  task_succeeded: z.boolean().optional(),\n  helpful: z.boolean(),                                   // Was this advice helpful?\n  feedback: z.string().optional(),                        // Optional feedback\n  reported_at: z.string().datetime(),\n});\n\nexport type ImpactReport = z.infer<typeof ImpactReport>;\n\n// Aggregated impact statistics\nexport const ImpactStats = z.object({\n  total_uses: z.number().default(0),                      // Times this advice was used\n  helpful_count: z.number().default(0),                   // Times marked helpful\n  avg_time_saved_seconds: z.number().optional(),          // Average actual time saved\n  success_rate: z.number().min(0).max(100).optional(),    // Actual success rate when used\n});\n\nexport type ImpactStats = z.infer<typeof ImpactStats>;\n\n// Core observation schema\nexport const Observation = z.object({\n  // Identity\n  id: z.string(),                        // UUID v4\n  agent_hash: z.string(),                // SHA-256 hash of agent identifier\n\n  // Location\n  domain: z.string(),                    // e.g., \"api.example.com\"\n  path: z.string().optional(),           // e.g., \"/v2/users\"\n\n  // Content\n  category: ObservationCategory,\n  summary: z.string(),                   // Human-readable summary\n  structured_data: StructuredData.optional(),\n\n  // Impact metrics\n  impact_estimate: ImpactEstimate.optional(),             // Observer's estimate\n  impact_reports: z.array(ImpactReport).default([]),      // Reports from users\n  impact_stats: ImpactStats.optional(),                   // Aggregated statistics\n\n  // Confirmation tracking\n  status: ObservationStatus.default('pending'),\n  confirmations: z.number().default(1),\n  confirming_agents: z.array(z.string()).default([]), // Agent hashes that confirmed\n  confidence: z.number().min(0).max(1).default(0),\n\n  // Metadata\n  urgency: UrgencyLevel.default('normal'),\n  tags: z.array(z.string()).default([]),\n\n  // Timestamps\n  created_at: z.string().datetime(),\n  updated_at: z.string().datetime(),\n  expires_at: z.string().datetime().optional(),\n});\n\nexport type Observation = z.infer<typeof Observation>;\n\n// Schema for creating new observations (without generated fields)\nexport const CreateObservation = z.object({\n  domain: z.string().min(1),\n  path: z.string().optional(),\n  category: ObservationCategory,\n  summary: z.string().min(1).max(2000),\n  structured_data: StructuredData.optional(),\n  impact_estimate: ImpactEstimate.optional(),\n  urgency: UrgencyLevel.optional(),\n  tags: z.array(z.string()).optional(),\n  expires_at: z.string().datetime().optional(),\n});\n\nexport type CreateObservation = z.infer<typeof CreateObservation>;\n\n// Schema for observation stored in JSONL (includes vector ID)\nexport const StoredObservation = Observation.extend({\n  vector_id: z.string().optional(),       // Qdrant point ID\n  content_hash: z.string(),               // SHA-256 of canonical content for deduplication\n});\n\nexport type StoredObservation = z.infer<typeof StoredObservation>;\n\n// Aggregation key for confirmation grouping\nexport const AggregationKey = z.object({\n  domain: z.string(),\n  path: z.string().optional(),\n  category: ObservationCategory,\n  content_hash: z.string(),\n});\n\nexport type AggregationKey = z.infer<typeof AggregationKey>;\n","import { z } from 'zod';\nimport { ObservationCategory, UrgencyLevel, Observation, ObservationStatus, ImpactEstimate } from './observation.js';\n\n// ============================================================================\n// substrate_observe - Record a new observation\n// ============================================================================\n\nexport const ObserveInput = z.object({\n  domain: z.string().min(1).describe('The domain being observed (e.g., \"api.example.com\")'),\n  path: z.string().optional().describe('The specific path or endpoint (e.g., \"/v2/checkout\")'),\n  category: ObservationCategory.describe('Category of observation'),\n  summary: z.string().min(1).max(2000).describe('Human-readable description of the observation'),\n  structured_data: z.record(z.unknown()).optional().describe('Structured data relevant to the category'),\n  impact_estimate: z.object({\n    time_saved_seconds: z.number().min(0).optional().describe('Estimated seconds this advice will save future agents'),\n    success_rate_improvement: z.number().min(0).max(100).optional().describe('Estimated % improvement in task success rate (0-100)'),\n    reasoning: z.string().optional().describe('Brief explanation of the estimate'),\n  }).optional().describe('Estimated impact of this advice for future agents'),\n  urgency: UrgencyLevel.optional().describe('Urgency level for sync prioritization'),\n  tags: z.array(z.string()).optional().describe('Tags for filtering and organization'),\n});\n\nexport type ObserveInput = z.infer<typeof ObserveInput>;\n\nexport const ObserveOutput = z.object({\n  success: z.boolean(),\n  observation_id: z.string().optional(),\n  message: z.string(),\n  matched_existing: z.boolean().optional(),\n  new_confirmation_count: z.number().optional(),\n});\n\nexport type ObserveOutput = z.infer<typeof ObserveOutput>;\n\n// ============================================================================\n// substrate_lookup - Exact lookup by domain/path\n// ============================================================================\n\nexport const LookupInput = z.object({\n  domain: z.string().min(1).describe('Domain to look up'),\n  path: z.string().optional().describe('Specific path to filter by'),\n  category: ObservationCategory.optional().describe('Filter by category'),\n  status: ObservationStatus.optional().describe('Filter by confirmation status'),\n  limit: z.number().min(1).max(100).default(20).describe('Maximum results to return'),\n});\n\nexport type LookupInput = z.infer<typeof LookupInput>;\n\nexport const LookupOutput = z.object({\n  observations: z.array(Observation),\n  total_count: z.number(),\n  has_more: z.boolean(),\n});\n\nexport type LookupOutput = z.infer<typeof LookupOutput>;\n\n// ============================================================================\n// substrate_search - Vector semantic search (primary search method)\n// ============================================================================\n\nexport const SearchInput = z.object({\n  query: z.string().min(1).describe('Natural language query for semantic search'),\n  domain: z.string().optional().describe('Filter results to specific domain'),\n  category: ObservationCategory.optional().describe('Filter by category'),\n  status: ObservationStatus.optional().describe('Filter by confirmation status'),\n  min_confidence: z.number().min(0).max(1).optional().describe('Minimum confidence threshold'),\n  limit: z.number().min(1).max(50).default(10).describe('Maximum results to return'),\n});\n\nexport type SearchInput = z.infer<typeof SearchInput>;\n\nexport const SearchResult = Observation.extend({\n  score: z.number().min(0).max(1).describe('Semantic similarity score'),\n});\n\nexport type SearchResult = z.infer<typeof SearchResult>;\n\nexport const SearchOutput = z.object({\n  results: z.array(SearchResult),\n  query_embedding_time_ms: z.number().optional(),\n  search_time_ms: z.number().optional(),\n});\n\nexport type SearchOutput = z.infer<typeof SearchOutput>;\n\n// ============================================================================\n// substrate_failures - List failure signals\n// ============================================================================\n\nexport const FailuresInput = z.object({\n  domain: z.string().optional().describe('Filter to specific domain'),\n  since: z.string().datetime().optional().describe('Filter to failures after this timestamp'),\n  limit: z.number().min(1).max(100).default(20).describe('Maximum results to return'),\n});\n\nexport type FailuresInput = z.infer<typeof FailuresInput>;\n\nexport const FailuresOutput = z.object({\n  failures: z.array(Observation),\n  total_count: z.number(),\n});\n\nexport type FailuresOutput = z.infer<typeof FailuresOutput>;\n\n// ============================================================================\n// substrate_confirm - Manual confirmation (admin)\n// ============================================================================\n\nexport const ConfirmInput = z.object({\n  observation_id: z.string().describe('ID of observation to confirm'),\n  action: z.enum(['confirm', 'reject', 'mark_stale']).describe('Confirmation action'),\n  reason: z.string().optional().describe('Reason for the action'),\n});\n\nexport type ConfirmInput = z.infer<typeof ConfirmInput>;\n\nexport const ConfirmOutput = z.object({\n  success: z.boolean(),\n  observation_id: z.string(),\n  new_status: ObservationStatus,\n  new_confidence: z.number(),\n  message: z.string(),\n});\n\nexport type ConfirmOutput = z.infer<typeof ConfirmOutput>;\n\n// ============================================================================\n// substrate_stats - Database statistics\n// ============================================================================\n\nexport const StatsInput = z.object({\n  domain: z.string().optional().describe('Get stats for specific domain'),\n});\n\nexport type StatsInput = z.infer<typeof StatsInput>;\n\nexport const StatsOutput = z.object({\n  total_observations: z.number(),\n  observations_by_status: z.record(z.number()),\n  observations_by_category: z.record(z.number()),\n  domains_count: z.number(),\n  top_domains: z.array(z.object({\n    domain: z.string(),\n    count: z.number(),\n  })),\n  confirmations: z.object({\n    pending: z.number(),\n    confirmed: z.number(),\n    contradicted: z.number(),\n    stale: z.number(),\n  }),\n  vector_index_size: z.number().optional(),\n  last_sync: z.string().datetime().optional(),\n});\n\nexport type StatsOutput = z.infer<typeof StatsOutput>;\n\n// ============================================================================\n// substrate_semantic_search - Alias for substrate_search (explicit semantic)\n// ============================================================================\n\nexport const SemanticSearchInput = SearchInput;\nexport type SemanticSearchInput = SearchInput;\n\nexport const SemanticSearchOutput = SearchOutput;\nexport type SemanticSearchOutput = SearchOutput;\n\n// ============================================================================\n// substrate_report_impact - Report the actual impact after using advice\n// ============================================================================\n\nexport const ReportImpactInput = z.object({\n  observation_id: z.string().describe('ID of the observation whose advice was used'),\n  helpful: z.boolean().describe('Was this advice helpful for completing the task?'),\n  task_succeeded: z.boolean().optional().describe('Did the task succeed using this advice?'),\n  actual_time_saved_seconds: z.number().min(0).optional().describe('Actual time saved in seconds'),\n  feedback: z.string().max(500).optional().describe('Optional feedback about the advice'),\n});\n\nexport type ReportImpactInput = z.infer<typeof ReportImpactInput>;\n\nexport const ReportImpactOutput = z.object({\n  success: z.boolean(),\n  observation_id: z.string(),\n  message: z.string(),\n  updated_stats: z.object({\n    total_uses: z.number(),\n    helpful_rate: z.number(),\n    avg_time_saved_seconds: z.number().optional(),\n    success_rate: z.number().optional(),\n  }).optional(),\n});\n\nexport type ReportImpactOutput = z.infer<typeof ReportImpactOutput>;\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport { ObserveInput, type ObserveOutput } from '../schemas/tools.js';\nimport type { StoredObservation } from '../schemas/observation.js';\nimport { generateObservationId } from '../utils/id-generator.js';\nimport { generateContentHash } from '../utils/hash.js';\n\nexport function registerObserveTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_observe',\n    'Record an observation about an interface, API, or webpage for future agents. Include impact estimates to help prioritize valuable advice.',\n    {\n      domain: z.string().describe('The domain being observed (e.g., \"api.example.com\")'),\n      path: z.string().optional().describe('The specific path or endpoint (e.g., \"/v2/checkout\")'),\n      category: z.enum(['behavior', 'error', 'auth', 'rate_limit', 'format']).describe('Category of observation'),\n      summary: z.string().describe('Human-readable description of the observation'),\n      structured_data: z.record(z.unknown()).optional().describe('Structured data relevant to the category'),\n      impact_estimate: z.object({\n        time_saved_seconds: z.number().min(0).optional().describe('Estimated seconds this advice saves (e.g., 300 = 5 minutes)'),\n        success_rate_improvement: z.number().min(0).max(100).optional().describe('Estimated % improvement in task success (e.g., 25 = 25% more likely to succeed)'),\n        reasoning: z.string().optional().describe('Brief explanation of the estimate'),\n      }).optional().describe('Estimated impact of this advice for future agents'),\n      urgency: z.enum(['normal', 'high', 'critical']).optional().describe('Urgency level for sync prioritization'),\n      tags: z.array(z.string()).optional().describe('Tags for filtering and organization'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const input = ObserveInput.parse(args);\n        const now = new Date().toISOString();\n\n        // Generate content hash for deduplication\n        const contentHash = generateContentHash(\n          input.domain,\n          input.path,\n          input.category,\n          input.structured_data\n        );\n\n        // Check for existing observation with same content hash\n        const existing = context.storage.query({\n          domain: input.domain,\n          path: input.path,\n          category: input.category,\n          limit: 1,\n        }).find(obs => (obs as StoredObservation).content_hash === contentHash);\n\n        if (existing) {\n          // Process through confirmation engine (adds confirmation)\n          const result = await context.confirmationEngine.processObservation(existing as StoredObservation);\n\n          const output: ObserveOutput = {\n            success: true,\n            observation_id: existing.id,\n            message: result.promotion.message,\n            matched_existing: true,\n            new_confirmation_count: result.aggregation.totalConfirmations,\n          };\n\n          return {\n            content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n          };\n        }\n\n        // Create new observation\n        const observation: StoredObservation = {\n          id: generateObservationId(),\n          agent_hash: context.agentHash,\n          domain: input.domain,\n          path: input.path,\n          category: input.category,\n          summary: input.summary,\n          structured_data: input.structured_data,\n          impact_estimate: input.impact_estimate,\n          impact_reports: [],\n          status: 'pending',\n          confirmations: 1,\n          confirming_agents: [context.agentHash],\n          confidence: 0,\n          urgency: input.urgency ?? 'normal',\n          tags: input.tags ?? [],\n          content_hash: contentHash,\n          created_at: now,\n          updated_at: now,\n        };\n\n        // Store observation\n        context.storage.insert(observation);\n\n        // Index in vector search\n        const vectorId = await context.vectorSearch.index(observation);\n        if (vectorId) {\n          context.storage.update(observation.id, { vector_id: vectorId });\n          observation.vector_id = vectorId;\n        }\n\n        // Process through confirmation engine\n        const result = await context.confirmationEngine.processObservation(observation);\n\n        // Export for sync\n        context.syncCoordinator.exportObservation(observation);\n\n        const output: ObserveOutput = {\n          success: true,\n          observation_id: observation.id,\n          message: `Observation recorded. ${result.promotion.message}`,\n          matched_existing: false,\n          new_confirmation_count: result.aggregation.totalConfirmations,\n        };\n\n        context.logger.info(`Observed: ${input.domain}${input.path ?? ''} [${input.category}]`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Observe failed:', message);\n\n        const output: ObserveOutput = {\n          success: false,\n          message: `Failed to record observation: ${message}`,\n        };\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { LookupOutput } from '../schemas/tools.js';\n\nexport function registerLookupTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_lookup',\n    'Look up observations by exact domain and optional path match',\n    {\n      domain: z.string().describe('Domain to look up'),\n      path: z.string().optional().describe('Specific path to filter by'),\n      category: z.enum(['behavior', 'error', 'auth', 'rate_limit', 'format']).optional().describe('Filter by category'),\n      status: z.enum(['pending', 'confirmed', 'contradicted', 'stale']).optional().describe('Filter by confirmation status'),\n      limit: z.number().min(1).max(100).default(20).describe('Maximum results to return'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { domain, path, category, status, limit } = args;\n\n        const observations = context.storage.query({\n          domain,\n          path,\n          category,\n          status,\n          limit: limit + 1, // Fetch one extra to check if there's more\n        });\n\n        const hasMore = observations.length > limit;\n        const results = hasMore ? observations.slice(0, limit) : observations;\n\n        const output: LookupOutput = {\n          observations: results,\n          total_count: context.storage.count({ domain, path, category, status }),\n          has_more: hasMore,\n        };\n\n        context.logger.debug(`Lookup: ${domain}${path ?? ''} returned ${results.length} results`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Lookup failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { SearchOutput, SearchResult } from '../schemas/tools.js';\n\nexport function registerSearchTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_search',\n    'Semantic search for observations using natural language queries. This is the primary search method.',\n    {\n      query: z.string().describe('Natural language query for semantic search'),\n      domain: z.string().optional().describe('Filter results to specific domain'),\n      category: z.enum(['behavior', 'error', 'auth', 'rate_limit', 'format']).optional().describe('Filter by category'),\n      status: z.enum(['pending', 'confirmed', 'contradicted', 'stale']).optional().describe('Filter by confirmation status'),\n      min_confidence: z.number().min(0).max(1).optional().describe('Minimum confidence threshold'),\n      limit: z.number().min(1).max(50).default(10).describe('Maximum results to return'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { query, domain, category, status, min_confidence, limit } = args;\n\n        // Check if vector search is available\n        if (!context.vectorSearch.isAvailable()) {\n          // Fallback to text-based search in SQLite\n          context.logger.warn('Vector search not available, falling back to SQLite query');\n\n          const observations = context.storage.query({\n            domain,\n            category,\n            status,\n            limit,\n          });\n\n          // Simple text matching fallback\n          const filtered = observations.filter(obs => {\n            if (min_confidence !== undefined && obs.confidence < min_confidence) {\n              return false;\n            }\n            const searchText = `${obs.domain} ${obs.path ?? ''} ${obs.summary}`.toLowerCase();\n            return query.toLowerCase().split(' ').some(word => searchText.includes(word));\n          });\n\n          const results: SearchResult[] = filtered.map(obs => ({\n            ...obs,\n            score: 0.5, // Placeholder score for fallback\n          }));\n\n          const output: SearchOutput = {\n            results,\n            query_embedding_time_ms: 0,\n            search_time_ms: 0,\n          };\n\n          return {\n            content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n          };\n        }\n\n        // Perform vector search\n        const { results: vectorResults, embedding_time_ms, search_time_ms } = await context.vectorSearch.search(\n          query,\n          {\n            domain,\n            category,\n            status,\n            min_confidence,\n            limit,\n          }\n        );\n\n        // Fetch full observation data for results\n        const results: SearchResult[] = [];\n        for (const result of vectorResults) {\n          const observation = context.storage.get(result.observation_id);\n          if (observation) {\n            results.push({\n              ...observation,\n              score: result.score,\n            });\n          }\n        }\n\n        const output: SearchOutput = {\n          results,\n          query_embedding_time_ms: embedding_time_ms,\n          search_time_ms,\n        };\n\n        context.logger.debug(`Search: \"${query}\" returned ${results.length} results in ${embedding_time_ms + search_time_ms}ms`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Search failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { FailuresOutput } from '../schemas/tools.js';\n\nexport function registerFailuresTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_failures',\n    'List recent failure signals (high/critical urgency errors)',\n    {\n      domain: z.string().optional().describe('Filter to specific domain'),\n      since: z.string().optional().describe('Filter to failures after this ISO timestamp'),\n      limit: z.number().min(1).max(100).default(20).describe('Maximum results to return'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { domain, since, limit } = args;\n\n        const failures = context.storage.getFailures({\n          domain,\n          since,\n          limit,\n        });\n\n        const output: FailuresOutput = {\n          failures,\n          total_count: failures.length,\n        };\n\n        context.logger.debug(`Failures: returned ${failures.length} results`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Failures lookup failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { ConfirmOutput } from '../schemas/tools.js';\n\nexport function registerConfirmTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_confirm',\n    'Manually confirm, reject, or mark an observation as stale (admin action)',\n    {\n      observation_id: z.string().describe('ID of observation to act on'),\n      action: z.enum(['confirm', 'reject', 'mark_stale']).describe('Confirmation action'),\n      reason: z.string().optional().describe('Reason for the action'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { observation_id, action, reason } = args;\n\n        let result;\n        switch (action) {\n          case 'confirm':\n            result = await context.confirmationEngine.manualConfirm(observation_id, reason);\n            break;\n          case 'reject':\n            result = await context.confirmationEngine.reject(observation_id, reason);\n            break;\n          case 'mark_stale':\n            result = await context.confirmationEngine.markStale(observation_id, reason);\n            break;\n        }\n\n        const output: ConfirmOutput = {\n          success: result.newStatus !== 'pending' || action === 'mark_stale',\n          observation_id,\n          new_status: result.newStatus,\n          new_confidence: result.newConfidence,\n          message: result.message,\n        };\n\n        context.logger.info(`Confirm: ${action} on ${observation_id} - ${result.message}`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Confirm action failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { StatsOutput } from '../schemas/tools.js';\n\nexport function registerStatsTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_stats',\n    'Get database statistics and overview',\n    {\n      domain: z.string().optional().describe('Get stats for specific domain'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { domain } = args;\n\n        const stats = context.storage.getStats(domain);\n        const vectorStats = await context.vectorSearch.getStats();\n\n        const output: StatsOutput = {\n          total_observations: stats.total_observations,\n          observations_by_status: stats.observations_by_status,\n          observations_by_category: stats.observations_by_category,\n          domains_count: stats.domains_count,\n          top_domains: stats.top_domains,\n          confirmations: {\n            pending: stats.observations_by_status['pending'] ?? 0,\n            confirmed: stats.observations_by_status['confirmed'] ?? 0,\n            contradicted: stats.observations_by_status['contradicted'] ?? 0,\n            stale: stats.observations_by_status['stale'] ?? 0,\n          },\n          vector_index_size: vectorStats?.points_count,\n        };\n\n        context.logger.debug(`Stats: ${stats.total_observations} total observations`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Stats failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { SemanticSearchOutput, SearchResult } from '../schemas/tools.js';\n\nexport function registerSemanticSearchTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_semantic_search',\n    'Explicit semantic search alias - searches observations using vector similarity',\n    {\n      query: z.string().describe('Natural language query for semantic search'),\n      domain: z.string().optional().describe('Filter results to specific domain'),\n      category: z.enum(['behavior', 'error', 'auth', 'rate_limit', 'format']).optional().describe('Filter by category'),\n      status: z.enum(['pending', 'confirmed', 'contradicted', 'stale']).optional().describe('Filter by confirmation status'),\n      min_confidence: z.number().min(0).max(1).optional().describe('Minimum confidence threshold'),\n      limit: z.number().min(1).max(50).default(10).describe('Maximum results to return'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { query, domain, category, status, min_confidence, limit } = args;\n\n        // This is an explicit semantic search - require vector search\n        if (!context.vectorSearch.isAvailable()) {\n          return {\n            content: [{\n              type: 'text',\n              text: JSON.stringify({\n                error: 'Semantic search requires Qdrant. Please start Qdrant: docker run -p 6333:6333 qdrant/qdrant',\n                fallback_hint: 'Use substrate_lookup for exact domain/path matching instead',\n              }, null, 2),\n            }],\n          };\n        }\n\n        // Perform vector search\n        const { results: vectorResults, embedding_time_ms, search_time_ms } = await context.vectorSearch.search(\n          query,\n          {\n            domain,\n            category,\n            status,\n            min_confidence,\n            limit,\n          }\n        );\n\n        // Fetch full observation data for results\n        const results: SearchResult[] = [];\n        for (const result of vectorResults) {\n          const observation = context.storage.get(result.observation_id);\n          if (observation) {\n            results.push({\n              ...observation,\n              score: result.score,\n            });\n          }\n        }\n\n        const output: SemanticSearchOutput = {\n          results,\n          query_embedding_time_ms: embedding_time_ms,\n          search_time_ms,\n        };\n\n        context.logger.debug(`Semantic search: \"${query}\" returned ${results.length} results`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Semantic search failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import { z } from 'zod';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\nimport type { ReportImpactOutput } from '../schemas/tools.js';\n\nexport function registerReportImpactTool(server: McpServer, context: SubstrateContext): void {\n  server.tool(\n    'substrate_report_impact',\n    'Report the actual impact after using advice from an observation. Helps improve advice quality by tracking what works.',\n    {\n      observation_id: z.string().describe('ID of the observation whose advice was used'),\n      helpful: z.boolean().describe('Was this advice helpful for completing the task?'),\n      task_succeeded: z.boolean().optional().describe('Did the task succeed using this advice?'),\n      actual_time_saved_seconds: z.number().min(0).optional().describe('Actual time saved in seconds'),\n      feedback: z.string().max(500).optional().describe('Optional feedback about the advice'),\n    },\n    async (args): Promise<{ content: Array<{ type: 'text'; text: string }> }> => {\n      try {\n        const { observation_id, helpful, task_succeeded, actual_time_saved_seconds, feedback } = args;\n\n        // Add the impact report\n        const result = context.storage.addImpactReport(observation_id, {\n          agent_hash: context.agentHash,\n          helpful,\n          task_succeeded,\n          actual_time_saved_seconds,\n          feedback,\n        });\n\n        if (!result.success) {\n          const output: ReportImpactOutput = {\n            success: false,\n            observation_id,\n            message: 'Observation not found',\n          };\n\n          return {\n            content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n          };\n        }\n\n        const stats = result.updated_stats;\n        const output: ReportImpactOutput = {\n          success: true,\n          observation_id,\n          message: `Impact reported. ${helpful ? 'Marked as helpful.' : 'Marked as not helpful.'} Total uses: ${stats?.total_uses ?? 0}`,\n          updated_stats: stats ? {\n            total_uses: stats.total_uses,\n            helpful_rate: stats.helpful_count / stats.total_uses * 100,\n            avg_time_saved_seconds: stats.avg_time_saved_seconds,\n            success_rate: stats.success_rate,\n          } : undefined,\n        };\n\n        context.logger.info(`Impact reported for ${observation_id}: helpful=${helpful}`);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify(output, null, 2) }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Report impact failed:', message);\n\n        return {\n          content: [{ type: 'text', text: JSON.stringify({ error: message }, null, 2) }],\n        };\n      }\n    }\n  );\n}\n","import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\n\nexport function registerDomainsResource(server: McpServer, context: SubstrateContext): void {\n  server.resource(\n    'substrate://domains',\n    'List of all observed domains with observation counts',\n    async () => {\n      try {\n        const domains = context.storage.getAllDomains();\n\n        const content = {\n          domains: domains.map(d => ({\n            domain: d.domain,\n            observation_count: d.count,\n          })),\n          total_domains: domains.length,\n        };\n\n        return {\n          contents: [{\n            uri: 'substrate://domains',\n            mimeType: 'application/json',\n            text: JSON.stringify(content, null, 2),\n          }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Domains resource failed:', message);\n\n        return {\n          contents: [{\n            uri: 'substrate://domains',\n            mimeType: 'application/json',\n            text: JSON.stringify({ error: message }),\n          }],\n        };\n      }\n    }\n  );\n}\n","import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\n\nexport function registerDomainResource(server: McpServer, context: SubstrateContext): void {\n  server.resource(\n    'substrate://domain/{domain}',\n    'Observations for a specific domain',\n    async (uri) => {\n      try {\n        // Extract domain from URI\n        const match = uri.href.match(/substrate:\\/\\/domain\\/(.+)/);\n        if (!match) {\n          return {\n            contents: [{\n              uri: uri.href,\n              mimeType: 'application/json',\n              text: JSON.stringify({ error: 'Invalid domain URI' }),\n            }],\n          };\n        }\n\n        const domain = decodeURIComponent(match[1]!);\n        const observations = context.storage.query({\n          domain,\n          limit: 100,\n        });\n\n        const stats = context.storage.getStats(domain);\n\n        const content = {\n          domain,\n          observations,\n          stats: {\n            total: stats.total_observations,\n            by_status: stats.observations_by_status,\n            by_category: stats.observations_by_category,\n          },\n        };\n\n        return {\n          contents: [{\n            uri: uri.href,\n            mimeType: 'application/json',\n            text: JSON.stringify(content, null, 2),\n          }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Domain resource failed:', message);\n\n        return {\n          contents: [{\n            uri: uri.href,\n            mimeType: 'application/json',\n            text: JSON.stringify({ error: message }),\n          }],\n        };\n      }\n    }\n  );\n}\n","import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\n\nexport function registerFailuresResource(server: McpServer, context: SubstrateContext): void {\n  server.resource(\n    'substrate://failures/recent',\n    'Recent failure signals from all domains',\n    async () => {\n      try {\n        // Get failures from last 24 hours\n        const since = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();\n\n        const failures = context.storage.getFailures({\n          since,\n          limit: 50,\n        });\n\n        const content = {\n          failures,\n          period: '24h',\n          total_count: failures.length,\n          generated_at: new Date().toISOString(),\n        };\n\n        return {\n          contents: [{\n            uri: 'substrate://failures/recent',\n            mimeType: 'application/json',\n            text: JSON.stringify(content, null, 2),\n          }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Failures resource failed:', message);\n\n        return {\n          contents: [{\n            uri: 'substrate://failures/recent',\n            mimeType: 'application/json',\n            text: JSON.stringify({ error: message }),\n          }],\n        };\n      }\n    }\n  );\n}\n","import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport type { SubstrateContext } from '../server.js';\n\nexport function registerStatsResource(server: McpServer, context: SubstrateContext): void {\n  server.resource(\n    'substrate://stats',\n    'Overall Substrate network statistics',\n    async () => {\n      try {\n        const stats = context.storage.getStats();\n        const vectorStats = await context.vectorSearch.getStats();\n\n        const content = {\n          observations: {\n            total: stats.total_observations,\n            by_status: stats.observations_by_status,\n            by_category: stats.observations_by_category,\n          },\n          domains: {\n            total: stats.domains_count,\n            top: stats.top_domains.slice(0, 10),\n          },\n          confirmation: {\n            pending: stats.observations_by_status['pending'] ?? 0,\n            confirmed: stats.observations_by_status['confirmed'] ?? 0,\n            contradicted: stats.observations_by_status['contradicted'] ?? 0,\n            stale: stats.observations_by_status['stale'] ?? 0,\n            threshold: context.confirmationEngine.getThreshold(),\n          },\n          vector_search: {\n            available: context.vectorSearch.isAvailable(),\n            indexed_points: vectorStats?.points_count ?? 0,\n          },\n          sync: {\n            enabled: context.syncCoordinator.isRunning(),\n            peers: context.syncCoordinator.getPeers().length,\n          },\n          generated_at: new Date().toISOString(),\n        };\n\n        return {\n          contents: [{\n            uri: 'substrate://stats',\n            mimeType: 'application/json',\n            text: JSON.stringify(content, null, 2),\n          }],\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        context.logger.error('Stats resource failed:', message);\n\n        return {\n          contents: [{\n            uri: 'substrate://stats',\n            mimeType: 'application/json',\n            text: JSON.stringify({ error: message }),\n          }],\n        };\n      }\n    }\n  );\n}\n","import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { Storage } from './storage/index.js';\nimport { VectorSearch } from './vector/index.js';\nimport { ConfirmationEngine } from './confirmation/index.js';\nimport { SyncCoordinator } from './sync/index.js';\nimport type { SubstrateConfig } from './schemas/config.js';\nimport { createDefaultConfig, configFromEnv } from './schemas/config.js';\nimport { getDefaultDataDir } from './utils/paths.js';\nimport { createConsoleLogger, type Logger } from './types/index.js';\n\n// Tool handlers\nimport { registerObserveTool } from './tools/observe.js';\nimport { registerLookupTool } from './tools/lookup.js';\nimport { registerSearchTool } from './tools/search.js';\nimport { registerFailuresTool } from './tools/failures.js';\nimport { registerConfirmTool } from './tools/confirm.js';\nimport { registerStatsTool } from './tools/stats.js';\nimport { registerSemanticSearchTool } from './tools/semantic-search.js';\nimport { registerReportImpactTool } from './tools/report-impact.js';\n\n// Resource handlers\nimport { registerDomainsResource } from './resources/domains.js';\nimport { registerDomainResource } from './resources/domain.js';\nimport { registerFailuresResource } from './resources/failures.js';\nimport { registerStatsResource } from './resources/stats.js';\n\nexport interface SubstrateContext {\n  storage: Storage;\n  vectorSearch: VectorSearch;\n  confirmationEngine: ConfirmationEngine;\n  syncCoordinator: SyncCoordinator;\n  config: SubstrateConfig;\n  logger: Logger;\n  agentHash: string;\n}\n\n/**\n * Create and configure the Substrate MCP server\n */\nexport async function createSubstrateServer(\n  userConfig?: Partial<SubstrateConfig>\n): Promise<{ server: McpServer; context: SubstrateContext; cleanup: () => void }> {\n  // Build configuration\n  const dataDir = userConfig?.data_dir ?? getDefaultDataDir();\n  const baseConfig = createDefaultConfig(dataDir);\n  const envConfig = configFromEnv(baseConfig);\n  const config: SubstrateConfig = { ...envConfig, ...userConfig };\n\n  // Create logger\n  const logger = createConsoleLogger(config.log_level);\n  logger.info('Initializing Substrate MCP server...');\n\n  // Initialize storage\n  const storage = new Storage(config);\n  logger.info('Storage initialized');\n\n  // Initialize vector search\n  const vectorSearch = new VectorSearch(config);\n  const vectorAvailable = await vectorSearch.initialize();\n  if (vectorAvailable) {\n    logger.info('Vector search initialized');\n  } else {\n    logger.warn('Vector search not available - Qdrant may not be running');\n  }\n\n  // Initialize confirmation engine\n  const confirmationConfig = config.confirmation ?? {\n    threshold: 3,\n    confidence_factor: 6,\n    contradiction_window_hours: 24,\n    stale_after_days: 30,\n  };\n  const confirmationEngine = new ConfirmationEngine(storage, confirmationConfig, vectorSearch);\n  logger.info('Confirmation engine initialized');\n\n  // Initialize sync coordinator\n  const syncConfig = config.sync ?? {\n    enabled: false,\n    interval_ms: 60000,\n    urgent_interval_ms: 5000,\n    outbox_path: `${dataDir}/outbox`,\n    peers: [],\n  };\n  const syncCoordinator = new SyncCoordinator(storage, syncConfig, confirmationEngine, vectorSearch);\n  if (syncConfig.enabled) {\n    syncCoordinator.start();\n    logger.info('Sync coordinator started');\n  }\n\n  // Generate agent hash\n  const { hashAgentId } = await import('./utils/hash.js');\n  const agentId = config.agent_id ?? `substrate-server-${Date.now()}`;\n  const agentHash = hashAgentId(agentId);\n\n  // Create context\n  const context: SubstrateContext = {\n    storage,\n    vectorSearch,\n    confirmationEngine,\n    syncCoordinator,\n    config,\n    logger,\n    agentHash,\n  };\n\n  // Create MCP server\n  const server = new McpServer({\n    name: 'substrate',\n    version: '0.2.0',\n  });\n\n  // Register tools\n  registerObserveTool(server, context);\n  registerLookupTool(server, context);\n  registerSearchTool(server, context);\n  registerFailuresTool(server, context);\n  registerConfirmTool(server, context);\n  registerStatsTool(server, context);\n  registerSemanticSearchTool(server, context);\n  registerReportImpactTool(server, context);\n\n  // Register resources\n  registerDomainsResource(server, context);\n  registerDomainResource(server, context);\n  registerFailuresResource(server, context);\n  registerStatsResource(server, context);\n\n  logger.info('Substrate MCP server ready');\n\n  // Cleanup function\n  const cleanup = () => {\n    logger.info('Shutting down Substrate MCP server...');\n    syncCoordinator.stop();\n    storage.close();\n    logger.info('Shutdown complete');\n  };\n\n  return { server, context, cleanup };\n}\n\nexport { McpServer };\n","import { createServer, type IncomingMessage, type ServerResponse } from 'node:http';\nimport type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';\n\nexport interface SSEServerOptions {\n  port: number;\n  host?: string;\n  apiKey?: string;\n  corsOrigins?: string[];\n}\n\n/**\n * Create an HTTP server with SSE transport for remote MCP access\n */\nexport function createSSEServer(\n  mcpServer: McpServer,\n  options: SSEServerOptions\n): { start: () => Promise<void>; stop: () => void } {\n  const { port, host = '0.0.0.0', apiKey, corsOrigins = ['*'] } = options;\n\n  let httpServer: ReturnType<typeof createServer> | null = null;\n  let sseTransport: SSEServerTransport | null = null;\n\n  const setCorsHeaders = (res: ServerResponse) => {\n    res.setHeader('Access-Control-Allow-Origin', corsOrigins.join(', '));\n    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\n    res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-API-Key');\n  };\n\n  const authenticate = (req: IncomingMessage): boolean => {\n    if (!apiKey) return true;\n\n    const authHeader = req.headers['authorization'];\n    const apiKeyHeader = req.headers['x-api-key'];\n\n    if (authHeader === `Bearer ${apiKey}`) return true;\n    if (apiKeyHeader === apiKey) return true;\n\n    return false;\n  };\n\n  const handleRequest = async (req: IncomingMessage, res: ServerResponse) => {\n    setCorsHeaders(res);\n\n    // Handle CORS preflight\n    if (req.method === 'OPTIONS') {\n      res.writeHead(204);\n      res.end();\n      return;\n    }\n\n    // Health check endpoint\n    if (req.url === '/health' && req.method === 'GET') {\n      res.writeHead(200, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ status: 'ok', transport: 'sse' }));\n      return;\n    }\n\n    // Authenticate\n    if (!authenticate(req)) {\n      res.writeHead(401, { 'Content-Type': 'application/json' });\n      res.end(JSON.stringify({ error: 'Unauthorized' }));\n      return;\n    }\n\n    // SSE endpoint for MCP\n    if (req.url === '/sse' && req.method === 'GET') {\n      // Create new transport for this connection\n      sseTransport = new SSEServerTransport('/message', res);\n      await mcpServer.connect(sseTransport);\n      return;\n    }\n\n    // Message endpoint for client-to-server messages\n    if (req.url === '/message' && req.method === 'POST') {\n      if (!sseTransport) {\n        res.writeHead(400, { 'Content-Type': 'application/json' });\n        res.end(JSON.stringify({ error: 'No active SSE connection' }));\n        return;\n      }\n\n      let body = '';\n      req.on('data', chunk => { body += chunk; });\n      req.on('end', async () => {\n        try {\n          await sseTransport!.handlePostMessage(req, res, body);\n        } catch (error) {\n          console.error('Error handling message:', error);\n          if (!res.headersSent) {\n            res.writeHead(500, { 'Content-Type': 'application/json' });\n            res.end(JSON.stringify({ error: 'Internal server error' }));\n          }\n        }\n      });\n      return;\n    }\n\n    // 404 for unknown routes\n    res.writeHead(404, { 'Content-Type': 'application/json' });\n    res.end(JSON.stringify({ error: 'Not found' }));\n  };\n\n  return {\n    start: () => new Promise<void>((resolve, reject) => {\n      httpServer = createServer(handleRequest);\n\n      httpServer.on('error', reject);\n\n      httpServer.listen(port, host, () => {\n        console.log(`MCP SSE server listening on http://${host}:${port}`);\n        console.log(`  SSE endpoint: http://${host}:${port}/sse`);\n        console.log(`  Health check: http://${host}:${port}/health`);\n        resolve();\n      });\n    }),\n\n    stop: () => {\n      if (httpServer) {\n        httpServer.close();\n        httpServer = null;\n      }\n    },\n  };\n}\n","import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport { createSubstrateServer } from './server.js';\nimport { createSSEServer } from './transports/sse.js';\n\nasync function main() {\n  const transportMode = process.env['SUBSTRATE_TRANSPORT'] ?? 'stdio';\n  const port = parseInt(process.env['PORT'] ?? process.env['SUBSTRATE_PORT'] ?? '3000', 10);\n  const apiKey = process.env['SUBSTRATE_API_KEY'];\n\n  const { server, cleanup } = await createSubstrateServer();\n\n  // Handle shutdown signals\n  let sseServer: ReturnType<typeof createSSEServer> | null = null;\n\n  const shutdown = () => {\n    console.log('Shutting down...');\n    if (sseServer) sseServer.stop();\n    cleanup();\n    process.exit(0);\n  };\n\n  process.on('SIGINT', shutdown);\n  process.on('SIGTERM', shutdown);\n\n  if (transportMode === 'sse' || transportMode === 'http') {\n    // HTTP/SSE transport for remote access\n    sseServer = createSSEServer(server, {\n      port,\n      apiKey,\n      corsOrigins: process.env['SUBSTRATE_CORS_ORIGINS']?.split(',') ?? ['*'],\n    });\n\n    await sseServer.start();\n    console.log('Substrate MCP server running in SSE mode');\n\n    if (apiKey) {\n      console.log('API key authentication enabled');\n    } else {\n      console.warn('WARNING: No API key set. Server is publicly accessible.');\n      console.warn('Set SUBSTRATE_API_KEY environment variable for production.');\n    }\n  } else {\n    // Stdio transport for local Claude Desktop\n    const transport = new StdioServerTransport();\n    await server.connect(transport);\n  }\n}\n\nmain().catch((error) => {\n  console.error('Fatal error:', error);\n  process.exit(1);\n});\n\n// Re-export for programmatic usage\nexport { createSubstrateServer } from './server.js';\nexport type { SubstrateContext } from './server.js';\nexport * from './schemas/index.js';\nexport * from './storage/index.js';\nexport * from './vector/index.js';\nexport * from './confirmation/index.js';\nexport * from './sync/index.js';\n"]}